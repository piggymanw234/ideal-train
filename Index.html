<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><title>DEAD WEST</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Rye&family=IM+Fell+English:ital@0;1&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;overflow:hidden;font-family:'IM Fell English',serif;cursor:none;}
canvas{display:block;}
#xh{position:fixed;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);width:20px;height:20px;}
#xh::before,#xh::after{content:'';position:absolute;background:rgba(255,215,55,.82);}
#xh::before{width:1px;height:20px;left:9px;top:0;}
#xh::after{width:20px;height:1px;top:9px;left:0;}
#xhd{position:fixed;pointer-events:none;z-index:9999;width:3px;height:3px;border-radius:50%;background:#ffd030;transform:translate(-50%,-50%);}
#vg{position:fixed;inset:0;background:radial-gradient(ellipse at center,transparent 42%,rgba(0,0,0,.74)100%);pointer-events:none;z-index:5;}
#bs{position:fixed;inset:0;pointer-events:none;z-index:6;opacity:0;transition:opacity .07s;background:radial-gradient(ellipse at center,transparent 26%,rgba(100,0,0,.5)100%);}

/* ‚ïê‚ïê‚ïê INTRO ‚ïê‚ïê‚ïê */
#intro{position:fixed;inset:0;z-index:3000;background:#000000;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;}
.i-tag{font-size:8px;letter-spacing:18px;color:#f7b06a;margin-bottom:18px;animation:iUp .8s .2s both;}
.i-logo{font-family:'Rye',serif;font-size:70px;letter-spacing:12px;color:#ebb064;text-shadow:0 0 80px rgba(255, 255, 255, 0.45);animation:iUp .9s .65s both,iGlow 2.8s 1.8s infinite alternate;position:relative;}
.i-sub{font-size:8px;letter-spacing:13px;color:#ffffff;margin-top:9px;animation:iUp .7s 1.2s both;}
.i-line{width:0;height:1px;background:linear-gradient(90deg,transparent,#8a6020,transparent);margin:20px auto;animation:iLine .9s 1.7s forwards;}
.i-skip{position:absolute;bottom:22px;right:22px;font-size:7px;letter-spacing:6px;color:#ffffff;animation:iUp .5s 2.3s both;}
.i-stars{position:absolute;top:22px;left:0;right:0;text-align:center;font-size:8px;letter-spacing:9px;color:#ff5900;animation:iUp .6s 2s both;}
@keyframes iUp{from{opacity:0;transform:translateY(9px)}to{opacity:1;transform:translateY(0)}}
@keyframes iGlow{from{text-shadow:0 0 55px rgba(200,140,28,.38)}to{text-shadow:0 0 115px rgba(235, 169, 38, 0.822),45 55 35px rgba(255, 255, 255, 0.952)}}
@keyframes iLine{to{width:270px}}

/* ‚ïê‚ïê‚ïê MENU ‚ïê‚ïê‚ïê */
#menu{position:fixed;inset:0;z-index:800;display:none;align-items:center;justify-content:center;background:radial-gradient(ellipse at 50% 55%,rgba(28,13,3,.98),rgba(3,2,1,.99));}
.m-wrap{display:flex;flex-direction:column;align-items:center;}
.m-tag{font-size:7px;letter-spacing:16px;color:#ce5b09;margin-bottom:7px;}
.m-title{font-family:'Rye',serif;font-size:56px;letter-spacing:10px;color:#ffffff;text-shadow:0 0 48px rgba(255, 255, 255, 0.28);margin-bottom:3px;}
.m-sub{font-size:8px;letter-spacing:11px;color:#f5ad40;margin-bottom:28px;}
.m-rule{width:250px;height:1px;background:linear-gradient(90deg,transparent,rgba(218, 135, 27, 0.3),transparent);margin-bottom:26px;}
.lobby{width:310px;border:1px solid rgba(228, 142, 13, 0.18);background:rgba(7,3,1,.96);padding:18px 20px 14px;margin-bottom:20px;}
.l-title{font-size:6px;letter-spacing:9px;color:#321604;text-align:center;margin-bottom:13px;padding-bottom:9px;border-bottom:1px solid rgba(90,52,8,.1);}
.field{margin-bottom:9px;}
.field label{display:block;font-size:6px;letter-spacing:7px;color:#da6811;margin-bottom:4px;}
.field input{width:100%;background:rgba(255, 255, 255, 0.92);border:none;border-bottom:1px solid rgba(0, 0, 0, 0.726);color:#000000;font-family:'IM Fell English',serif;font-size:12px;padding:5px 2px;outline:none;letter-spacing:3px;transition:border-color .2s;}
.field input:focus{border-bottom-color:rgba(170,110,25,.5);}
.field input::placeholder{color:#180c02;font-size:10px;letter-spacing:2px;}
.l-hint{font-size:6px;color:#fdfdfd;letter-spacing:2px;text-align:center;margin-top:3px;}
.l-status{font-size:7px;text-align:center;margin-top:5px;min-height:11px;letter-spacing:2px;}
.btn-row{display:flex;gap:6px;margin-top:12px;}
.btn{flex:1;font-family:'Rye',serif;background:transparent;border:1px solid rgba(255, 255, 255, 0.884);padding:9px 10px;font-size:7px;letter-spacing:6px;cursor:pointer;transition:all .2s;}
.btn-p{color:#ffe9e9;border-color:rgba(255, 255, 255, 0.42);}
.btn-p:hover{background:rgba(255, 255, 255, 0.1);border-color:rgba(195,135,35,.6);}
.btn-s{color:#ffffff;border-color:rgba(255, 255, 255, 0.18);}
.btn-s:hover{color:#ffffff;border-color:rgba(105,62,10,.35);}
.ctrl{display:grid;grid-template-columns:1fr 1fr;gap:3px 28px;}
.ctrl-r{font-size:7px;color:#ffffff;letter-spacing:3px;}
.ctrl-r b{color:#ffffff;font-weight:normal;}

/* ‚ïê‚ïê‚ïê DEATH ‚ïê‚ïê‚ïê */
#dead{position:fixed;inset:0;z-index:800;display:none;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.94);}
.d-title{font-family:'Rye',serif;color:#880000;font-size:50px;letter-spacing:8px;text-shadow:0 0 38px rgba(100,0,0,.5);margin-bottom:9px;}
.d-s{font-size:9px;color:#481e05;letter-spacing:4px;margin-bottom:4px;}
.d-p{font-size:8px;color:#941010;letter-spacing:3px;margin-bottom:28px;}

/* ‚ïê‚ïê‚ïê HUD ‚ïê‚ïê‚ïê */
#hud{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10;}
.pn{background:rgba(4,2,1,.93);border:1px solid rgba(135,90,18,.14);}
#hl{position:absolute;top:12px;left:12px;padding:8px 12px;min-width:162px;}
.hl-r{display:flex;justify-content:space-between;align-items:flex-end;}
.lb{font-size:6px;letter-spacing:5px;color:#381e05;margin-bottom:2px;}
.vl{font-family:'Rye',serif;color:#e8c87a;font-size:14px;}
#xpb{width:100%;height:2px;background:rgba(255,255,255,.04);margin-top:4px;}
#xpf{height:100%;background:linear-gradient(90deg,#783a05,#d2a628);}
#xpt{font-size:5px;color:#2c1804;letter-spacing:2px;margin-top:2px;}
#hm{position:absolute;bottom:12px;left:12px;padding:7px 12px;}
#hmv{font-family:'Rye',serif;color:#dbc838;font-size:16px;}
#hk{position:absolute;bottom:12px;left:125px;padding:7px 10px;}
#hkv{font-family:'Rye',serif;color:#48aa48;font-size:12px;}
#hkl{font-size:5px;color:#245018;letter-spacing:2px;margin-top:1px;}
#hg{position:absolute;top:12px;right:12px;padding:8px 12px;min-width:145px;text-align:right;}
#gn{font-family:'Rye',serif;color:#e8c87a;font-size:10px;letter-spacing:2px;margin-bottom:2px;}
#ga{font-size:6px;color:#583a05;letter-spacing:2px;margin-bottom:4px;font-style:italic;}
#pp{margin-bottom:2px;min-height:12px;}
.pip{display:inline-block;width:5px;height:10px;background:#dbb834;margin:0 1px;border-radius:1px 1px 0 0;vertical-align:middle;}
.pip.e{background:#140902;border:1px solid #200f02;}
.pip.sg{width:7px;background:#a85e0e;}
.pip.sg.e{background:#1c0b02;}
#ar{font-size:6px;color:#382404;letter-spacing:2px;}
#cdb{width:100%;height:1px;background:rgba(255,255,255,.04);margin-top:3px;}
#cdf{height:100%;background:#885618;}
#hh{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);padding:6px 14px;text-align:center;}
#hbt{width:175px;height:4px;background:rgba(255,255,255,.04);border:1px solid rgba(130,38,22,.1);margin-top:3px;}
#hbf{height:100%;background:linear-gradient(90deg,#620000,#b40c12);}
#hw{position:absolute;bottom:12px;right:12px;padding:6px 11px;text-align:right;border-color:rgba(125,22,18,.14);}
#ws{font-size:13px;color:#a81212;letter-spacing:2px;}
#wl{font-size:5px;letter-spacing:5px;color:#381210;margin-bottom:2px;}
#wdb{width:100%;height:1px;background:rgba(255,255,255,.04);margin-top:2px;}
#wdf{height:100%;background:#961010;}
#lc{position:absolute;top:12px;left:50%;transform:translateX(-50%);text-align:center;opacity:0;transition:opacity .5s;pointer-events:none;}
#ln{font-family:'Rye',serif;color:#e8c87a;font-size:13px;letter-spacing:7px;text-shadow:0 0 15px rgba(195,135,38,.5);}
#ls{font-size:6px;color:#583808;letter-spacing:4px;}
#mst{position:absolute;top:38px;left:50%;transform:translateX(-50%);font-size:6px;letter-spacing:3px;color:#263416;pointer-events:none;}
.fl{position:absolute;left:50%;transform:translateX(-50%);font-family:'Rye',serif;letter-spacing:5px;opacity:0;transition:opacity .14s;pointer-events:none;}
#fk{top:44%;color:#c89c12;font-size:11px;}
#fb{top:40%;color:#e8c87a;font-size:15px;}
#fp{top:36%;color:#3a78ee;font-size:12px;}
#ft{top:32%;color:#d08c18;font-size:12px;}
#rlw{position:absolute;bottom:65px;left:50%;transform:translateX(-50%);text-align:center;opacity:0;pointer-events:none;}
#rll{font-size:6px;color:#e8c87a;letter-spacing:6px;margin-bottom:3px;}
#rlt{width:94px;height:2px;background:rgba(255,255,255,.04);margin:0 auto;}
#rlf{height:100%;background:#e8c87a;width:0%;}
#trb{position:absolute;top:25%;left:50%;transform:translateX(-50%);background:rgba(4,2,1,.94);border:1px solid rgba(145,78,14,.34);padding:10px 22px;opacity:0;transition:opacity .3s;pointer-events:none;text-align:center;}
#trt{font-family:'Rye',serif;color:#d08c18;font-size:12px;letter-spacing:5px;margin-bottom:2px;}
#trh{font-size:7px;color:#483005;letter-spacing:3px;}
#tip{position:absolute;bottom:48px;left:50%;transform:translateX(-50%);font-size:6px;color:#201202;letter-spacing:2px;pointer-events:none;white-space:nowrap;}
#mmw{position:absolute;bottom:70px;right:12px;pointer-events:none;}
#mmc{border:1px solid rgba(135,90,18,.2);}
#mml{font-size:5px;color:#201002;letter-spacing:2px;text-align:center;margin-top:2px;}

/* ‚ïê‚ïê‚ïê CHAT ‚ïê‚ïê‚ïê */
#chat{position:fixed;bottom:82px;left:12px;width:245px;z-index:20;pointer-events:none;}
#cmsg{display:flex;flex-direction:column;gap:2px;max-height:108px;overflow:hidden;justify-content:flex-end;}
.cm{background:rgba(3,2,1,.8);border-left:1px solid rgba(115,72,10,.18);padding:2px 6px;font-size:18px;color:#887228;animation:cmf 9s forwards;}
.cm .cn{color:#ffffff;margin-right:4px;}
.cm.sys{color:#2c4220;border-left-color:rgba(35,58,18,.18);}
@keyframes cmf{0%,55%{opacity:1}100%{opacity:0}}
#ci{pointer-events:all;display:none;background:rgba(4,2,1,.94);border:1px solid rgba(135,90,18,.2);padding:4px 8px;align-items:center;gap:5px;}
#ci.on{display:flex;}
#cip{font-size:6px;color:#482a05;letter-spacing:4px;}
#cif{flex:1;background:transparent;border:none;color:#e8c87a;font-family:'IM Fell English',serif;font-size:10px;outline:none;}

/* ‚ïê‚ïê‚ïê GUN SHOP ‚ïê‚ïê‚ïê */
#gso{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:60;pointer-events:all;}
#gsb{background:rgba(4,2,1,.98);border:1px solid rgba(135,90,18,.22);width:800px;max-width:95vw;max-height:88vh;overflow-y:auto;}
.sh{padding:15px 22px 9px;border-bottom:1px solid rgba(95,58,8,.1);text-align:center;}
.sh h2{font-family:'Rye',serif;color:#e8c87a;font-size:15px;letter-spacing:8px;margin-bottom:2px;}
.sh p{font-size:6px;color:#482a05;letter-spacing:6px;}
#gsm{font-family:'Rye',serif;color:#dbc838;font-size:10px;margin-top:4px;}
#gstabs{display:flex;padding:0 22px;border-bottom:1px solid rgba(95,58,8,.1);}
.stab{font-family:'Rye',serif;color:#1c1001;background:transparent;border:none;border-bottom:2px solid transparent;padding:8px 13px;font-size:6px;letter-spacing:6px;cursor:pointer;transition:all .2s;}
.stab:hover,.stab.on{color:#e8c87a;border-bottom-color:#624010;}
#gsgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:11px 22px 15px;}
.gc{background:rgba(6,3,1,.92);border:1px solid rgba(55,35,6,.24);padding:8px 6px;cursor:pointer;transition:border-color .2s;text-align:center;position:relative;}
.gc:hover:not(.lk){border-color:rgba(145,95,18,.36);}
.gc.eq{border-color:rgba(165,110,22,.52);}
.gc.lk{opacity:.34;cursor:not-allowed;}
.gpx{display:block;margin:0 auto 5px;image-rendering:pixelated;background:#040201;}
.gn{font-family:'Rye',serif;color:#e8c87a;font-size:7px;letter-spacing:2px;margin-bottom:2px;}
.gd{font-size:5px;color:#382204;letter-spacing:1px;font-style:italic;margin-bottom:3px;}
.gst{display:grid;grid-template-columns:1fr 1fr;gap:1px 4px;margin-bottom:3px;}
.gst div{font-size:5px;color:#221402;letter-spacing:1px;}
.gst span{color:#644810;}
.gp{font-family:'Rye',serif;font-size:8px;color:#dbc838;}
.gbdg{position:absolute;top:2px;right:2px;font-size:5px;padding:1px 3px;}
.gbdg.o{background:rgba(32,95,32,.13);color:#3e9e3e;border:1px solid rgba(32,95,32,.2);}
.gbdg.e{background:rgba(145,95,18,.13);color:#e8c87a;border:1px solid rgba(145,95,18,.22);}
.scl{font-family:'Rye',serif;color:#382005;border:1px solid rgba(75,45,7,.26);background:transparent;padding:6px 26px;font-size:6px;letter-spacing:6px;cursor:pointer;display:block;margin:0 auto 13px;transition:all .2s;}
.scl:hover{color:#e8c87a;border-color:#624010;}

/* ‚ïê‚ïê‚ïê GENERAL STORE ‚ïê‚ïê‚ïê */
#sto{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:60;pointer-events:all;}
#stob{background:rgba(4,2,1,.98);border:1px solid rgba(38,95,32,.18);width:370px;max-width:95vw;}
.si{background:rgba(5,9,3,.9);border:1px solid rgba(32,80,28,.16);padding:10px 13px;display:flex;align-items:center;gap:10px;margin:0 16px 6px;cursor:pointer;transition:border-color .2s;}
.si:hover:not(.sd){border-color:rgba(46,120,40,.28);}
.si.sd{opacity:.38;cursor:not-allowed;}
.sic{font-size:23px;}
.sin h3{font-family:'Rye',serif;color:#da611b;font-size:9px;letter-spacing:2px;margin-bottom:2px;}
.sin p{font-size:6px;color:#1c3012;letter-spacing:1px;}
.sir{font-size:5px;color:#482805;letter-spacing:2px;margin-top:2px;}
.sip{font-family:'Rye',serif;color:#dbc838;font-size:12px;margin-left:auto;}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="xh"></div><div id="xhd"></div>
<div id="vg"></div><div id="bs"></div>

<!-- INTRO -->
<div id="intro">
  <div class="i-stars">‚ú¶ &nbsp;&nbsp; ‚ú¶ &nbsp;&nbsp; ‚ú¶</div>
  <div class="i-tag">NAVIS GAMES PRESENTS</div>
  <div class="i-logo">DEAD WEST</div>
  <div class="i-sub">OPEN WORLD BOUNTY HUNTER</div>
  <div class="i-line"></div>
  <div class="i-skip">CLICK TO SKIP ‚Üí</div>
</div>

<!-- MENU -->
<div id="menu">
  <div class="m-wrap">
    <div class="m-tag">NAVIS GAMES PRESENTS</div>
    <div class="m-title">DEAD WEST</div>
    <div class="m-sub">OPEN WORLD BOUNTY HUNTER</div>
    <div class="m-rule"></div>
    <div class="lobby">
      <div class="l-title">‚ö° MULTIPLAYER LOBBY</div>
      <div class="field"><label>YOUR NAME</label><input id="mpname" maxlength="14" placeholder="e.g. JESSE OUTLAW" spellcheck="false" autocomplete="off"></div>
      <div class="field"><label>ROOM CODE</label><input id="mproom" maxlength="10" placeholder="e.g. DUSTY1 ‚Äî share with friends" spellcheck="false" autocomplete="off"></div>
      <div class="l-hint">same code = same world</div>
      <div class="l-status" id="mpstat"></div>
      <div class="btn-row">
        <button class="btn btn-p" onclick="joinMP()">JOIN GAME</button>
        <button class="btn btn-s" onclick="soloStart()">SOLO RIDE</button>
      </div>
    </div>
    <div class="ctrl">
      <div class="ctrl-r"><b>WASD</b> MOVE</div><div class="ctrl-r"><b>MOUSE</b> AIM</div>
      <div class="ctrl-r"><b>CLICK</b> SHOOT</div><div class="ctrl-r"><b>R</b> RELOAD</div>
      <div class="ctrl-r"><b>SHIFT</b> DASH</div><div class="ctrl-r"><b>E</b> SHOP</div>
      <div class="ctrl-r"><b>F</b> MEDKIT</div><div class="ctrl-r"><b>T</b> CHAT</div>
      <div class="ctrl-r"><b>G</b> ROB TRAIN</div><div class="ctrl-r"><b>RMB</b> SPECIAL</div>
    </div>
  </div>
</div>

<!-- DEATH -->
<div id="dead">
  <div class="d-title">YOU DIED</div>
  <div class="d-s" id="dsub"></div>
  <div class="d-p" id="dpen"></div>
  <button class="btn btn-p" style="width:175px;pointer-events:all" onclick="restartGame()">RIDE AGAIN</button>
</div>

<!-- HUD -->
<div id="hud">
  <div class="pn" id="hl">
    <div class="hl-r">
      <div><div class="lb">BOUNTY HUNTER</div><div class="vl" id="lvv">LVL 1</div></div>
      <div style="text-align:right"><div class="lb">HP</div><div class="vl" id="hpn">100</div></div>
    </div>
    <div id="xpb"><div id="xpf" style="width:0%"></div></div>
    <div id="xpt">0 / 100 XP</div>
  </div>
  <div id="lc"><div id="ln"></div><div id="ls"></div></div>
  <div id="mst">‚óè SOLO</div>
  <div class="pn" id="hg">
    <div class="lb">EQUIPPED</div><div id="gn">PEACEMAKER</div>
    <div id="ga">Reliable 6-Shot</div>
    <div id="pp"></div><div id="ar"></div>
    <div id="cdb"><div id="cdf" style="width:0%"></div></div>
  </div>
  <div class="pn" id="hm"><div class="lb">EARNINGS</div><div id="hmv">$0</div></div>
  <div class="pn" id="hk"><div class="lb">MEDKITS</div><div id="hkv">‚úö 0</div><div id="hkl">[F]USE</div></div>
  <div class="pn" id="hh"><div class="lb">HEALTH</div><div id="hbt"><div id="hbf" style="width:100%"></div></div></div>
  <div class="pn" id="hw"><div id="wl">WANTED</div><div id="ws">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div><div id="wdb"><div id="wdf" style="width:100%"></div></div></div>
  <div class="fl" id="fk"></div><div class="fl" id="fb"></div><div class="fl" id="fp"></div><div class="fl" id="ft"></div>
  <div id="rlw"><div id="rll">‚Äî RELOADING ‚Äî</div><div id="rlt"><div id="rlf"></div></div></div>
  <div id="trb"><div id="trt">üöÇ TRAIN!</div><div id="trh">[G] TO ROB</div></div>
  <div id="tip">[E]SHOP ¬∑ [F]MEDKIT ¬∑ [G]ROB TRAIN ¬∑ [T]CHAT ¬∑ [SHIFT]DASH</div>
  <div id="mmw"><canvas id="mmc" width="146" height="146"></canvas><div id="mml">‚óè BOUNTY ¬∑ ‚óè LAW ¬∑ üöÇ TRAIN</div></div>
</div>

<!-- CHAT -->
<div id="chat">
  <div id="cmsg"></div>
  <div id="ci"><span id="cip">SAY:</span><input id="cif" maxlength="80" placeholder="‚Ä¶" spellcheck="false" autocomplete="off"></div>
</div>

<!-- GUN SHOP -->
<div id="gso">
  <div id="gsb">
    <div class="sh"><h2>GUN SHOP</h2><p>FINEST IRON IN THE TERRITORY</p><div id="gsm"></div></div>
    <div id="gstabs">
      <button class="stab on" onclick="setTab('pistols',this)">PISTOLS</button>
      <button class="stab" onclick="setTab('shotguns',this)">SHOTGUNS</button>
      <button class="stab" onclick="setTab('rifles',this)">RIFLES</button>
    </div>
    <div id="gsgrid"></div>
    <button class="scl" onclick="closeShop()">HOLSTER UP</button>
  </div>
</div>

<!-- GENERAL STORE -->
<div id="sto">
  <div id="stob">
    <div class="sh"><h2 style="color:#42b842;font-size:14px">GENERAL STORE</h2><p>FRONTIER SUPPLIES</p><div id="stom" style="font-family:'Rye',serif;color:#dbc838;font-size:10px;margin-top:4px"></div></div>
    <div id="stolist" style="padding:6px 0 2px"></div>
    <button class="scl" onclick="closeGStore()">SADDLE UP</button>
  </div>
</div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
'use strict';
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DEAD WEST ‚Äî ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const C=document.getElementById('c'),X=C.getContext('2d');
const MM=document.getElementById('mmc'),MX=MM.getContext('2d');
let W,H,CX,CY;
function resize(){W=C.width=innerWidth;H=C.height=innerHeight;CX=W>>1;CY=H>>1;}
resize();addEventListener('resize',resize);
const cam={x:0,y:0,shake:0,sx:0,sy:0};
function ws(wx,wy){return[wx-cam.x+CX+cam.sx,wy-cam.y+CY+cam.sy];}

// cursor
const XH=document.getElementById('xh'),XHD=document.getElementById('xhd');
addEventListener('mousemove',e=>{XH.style.left=e.clientX+'px';XH.style.top=e.clientY+'px';XHD.style.left=e.clientX+'px';XHD.style.top=e.clientY+'px';});

// input
const K={},mouse={x:0,y:0,wx:0,wy:0,dn:false};
let chatOpen=false,shopOpen=false,gstOpen=false,gameOn=false;
addEventListener('keydown',e=>{
  if(['mpname','mproom','cif'].includes(document.activeElement?.id))return;
  K[e.code]=true;
  if(!gameOn)return;
  if(e.code==='KeyR')startReload();
  if(e.code==='KeyE')tryInteract();
  if(e.code==='KeyF')useMedkit();
  if(e.code==='KeyG')robTrain();
  if(e.code==='KeyT'){e.preventDefault();if(!chatOpen){chatOpen=true;document.getElementById('ci').classList.add('on');document.getElementById('cif').focus();}}
  if(e.code==='Escape'){closeShop();closeGStore();}
});
addEventListener('keyup',e=>delete K[e.code]);
addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});
addEventListener('mousedown',e=>{if(e.button===0)mouse.dn=true;if(e.button===2)onRMB();});
addEventListener('mouseup',e=>{if(e.button===0)mouse.dn=false;});
addEventListener('contextmenu',e=>e.preventDefault());
document.getElementById('cif').addEventListener('keydown',e=>{
  if(e.code==='Enter'){const v=e.target.value.trim();if(v)mpSendChat(v);e.target.value='';chatOpen=false;document.getElementById('ci').classList.remove('on');}
  if(e.code==='Escape'){chatOpen=false;document.getElementById('ci').classList.remove('on');}
});

// ‚îÄ‚îÄ PIXEL ART GUN DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 14√ó8 pixel grids, drawn at 4px scale
const GPX={
  peacemaker:[
    '.......BBBBBBB',
    '....BBBGGGGGGB',
    '...BGGGGGBB...',
    '...BGGGB......',
    '....BBB.......',
    '....B.B.......',
    '....BBB.......',
    '..............',
  ],
  cattleman:[
    '.......BBBBBBB',
    '....BBBYYYYYYB',
    '...BYYYYBB....',
    '...BYYYYB.....',
    '....BBB.......',
    '....B.B.......',
    '....BBB.......',
    '..............',
  ],
  schofield:[
    '........BBBBBB',
    '.....BBBSSSSSSB',
    '....BSSSSSBB..',
    '....BSSSSB....',
    '.....BBB......',
    '.....B.B......',
    '.....BBB......',
    '..............',
  ],
  volcanic:[
    '.......BBBBBBBBB',
    '....BBBVVVVVVVVB',
    '...BVVVVVBB.....',
    '...BVVVVB.......',
    '....BBB.........',
    '....B.B.........',
    '....BBB.........',
    '................',
  ],
  navy:[
    '.........BBBBBBB',
    '......BBBNNNNNNNB',
    '.....BNNNNNBB....',
    '.....BNNNNNB.....',
    '......BBB........',
    '......B.B........',
    '......BBB........',
    '.................',
  ],
  lematt:[
    '.......BBBBBBBB',
    '....BBBLLLLLLLLB',
    '...BLLLLLLBB....',
    '...BLLLLBB......',
    '...BLLBB........',
    '....BBB.........',
    '....B.B.........',
    '....BBB.........',
  ],
  coach:[
    '..CCBBBBBBBBBB',
    '..CCBBBBBBBBBB',
    '..CC..........',
    '..CCBBBBBBBBBB',
    '..CCBBBBBBBBBB',
    '...BB.........',
    '...BB.........',
    '..............',
  ],
  sawnoff:[
    '...CBBBBBB',
    '...CBBBBBB',
    '...C......',
    '...CBBBBBB',
    '...CBBBBBB',
    '....BB....',
    '....BB....',
    '..........',
  ],
  pump:[
    '..........BBBBB',
    '....BBBBBPPPPPPB',
    '....BPPPPPBB....',
    '....BPPPB.......',
    '.....BBB........',
    '.....B.B........',
    '.....BBB........',
    '................',
  ],
  repeaterSg:[
    '...........BBBBBB',
    '....BBBBBBBRRRRRRB',
    '....BRRRRRRBB.....',
    '....BRRRRB........',
    '.....BBB..........',
    '.....B.B..........',
    '.....BBB..........',
    '..................',
  ],
  carbine:[
    '..............BBBBB',
    '....BBBBBBBBBBAAAAAAB',
    '....BAAAAAAAAAABB....',
    '....BAAAAAB..........',
    '.....BBB.............',
    '.....B.B.............',
    '.....BBB.............',
    '.....................',
  ],
  springfield:[
    '................BBBBB',
    '....BBBBBBBBBBBBFFFFFB',
    '....BFFFFFFFFFBB......',
    '....BFFFFFFFB.........',
    '.....BBB..............',
    '.....B.B..............',
    '.....BBB..............',
    '......................',
  ],
  repeater:[
    '..............BBBBB',
    '....BBBBBBBBBBWWWWWB',
    '....BWWWWWWWWWBB....',
    '....BWWWWWB.........',
    '.....BBB............',
    '.....B.B............',
    '.....BBB............',
    '...................',
  ],
};
const GCMAP={
  peacemaker:{B:'#181614',G:'#7a4e2c','.':null},
  cattleman:{B:'#181614',Y:'#684018','.':null},
  schofield:{B:'#1a1c22',S:'#464e58','.':null},
  volcanic:{B:'#161408',V:'#565840','.':null},
  navy:{B:'#100e1c',N:'#363444','.':null},
  lematt:{B:'#0c0a06',L:'#583c1e','.':null},
  coach:{B:'#181210',C:'#5e4830','.':null},
  sawnoff:{B:'#181210',C:'#4a301e','.':null},
  pump:{B:'#121010',P:'#383028','.':null},
  repeaterSg:{B:'#121010',R:'#5e4836','.':null},
  carbine:{B:'#0e0c06',A:'#38301e','.':null},
  springfield:{B:'#0a0804',F:'#2c2810','.':null},
  repeater:{B:'#0e0c08',W:'#464030','.':null},
};
function drawGunPx(ctx,id,ox,oy,sc){
  const rows=GPX[id],cm=GCMAP[id];if(!rows||!cm)return;
  rows.forEach((row,r)=>{for(let c=0;c<row.length;c++){const col=cm[row[c]];if(col){ctx.fillStyle=col;ctx.fillRect(ox+c*sc,oy+r*sc,sc,sc);}}});
}

// ‚îÄ‚îÄ GUNS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GUNS={
  pistols:[
    {id:'peacemaker',nm:'PEACEMAKER',price:0,owned:true,ab:'Reliable',desc:'Balanced starter',ammo:6,res:120,dmg:18,fr:.22,rt:2.0,spd:900,spr:.04,rng:1.4},
    {id:'cattleman',nm:"CATTLEMAN'S",price:1200,owned:false,ab:'Burst',desc:'2 rapid shots',ammo:6,res:120,dmg:16,fr:.24,rt:2.1,spd:860,spr:.07,rng:1.2,sp:'burst'},
    {id:'schofield',nm:'SCHOFIELD',price:3500,owned:false,ab:'Fast Reload',desc:'Reloads in 0.9s',ammo:6,res:144,dmg:21,fr:.20,rt:.9,spd:940,spr:.025,rng:1.6},
    {id:'volcanic',nm:'VOLCANIC',price:8000,owned:false,ab:'10 Rounds',desc:'High-capacity lever',ammo:10,res:200,dmg:15,fr:.17,rt:2.6,spd:830,spr:.05,rng:1.3},
    {id:'navy',nm:'NAVY REVOLVER',price:18000,owned:false,ab:'Death Blow',desc:'Massive damage',ammo:6,res:90,dmg:44,fr:.42,rt:2.4,spd:1000,spr:.015,rng:2.0},
    {id:'lematt',nm:'LeMATT',price:45000,owned:false,ab:'Explosive',desc:'RMB = grenade',ammo:9,res:180,dmg:24,fr:.20,rt:3.0,spd:880,spr:.04,rng:1.4,sp:'explosive'},
  ],
  shotguns:[
    {id:'coach',nm:'COACH GUN',price:2500,owned:false,ab:'Double Barrel',desc:'RMB fires both',ammo:2,res:50,dmg:55,fr:.35,rt:1.8,spd:700,spr:.22,rng:.7,sg:true,pc:8},
    {id:'sawnoff',nm:"SAW'D OFF",price:4000,owned:false,ab:'Point Blank',desc:'Brutal close range',ammo:2,res:60,dmg:70,fr:.30,rt:1.4,spd:600,spr:.32,rng:.45,sg:true,pc:10},
    {id:'pump',nm:'PUMP ACTION',price:6500,owned:false,ab:'4 Shells',desc:'Pump reliability',ammo:4,res:40,dmg:45,fr:.55,rt:2.8,spd:720,spr:.18,rng:.75,sg:true,pc:7},
    {id:'repeaterSg',nm:'SHOT REPEATER',price:14000,owned:false,ab:'6-Shell Lever',desc:'Rapid lever shotgun',ammo:6,res:48,dmg:38,fr:.45,rt:3.2,spd:740,spr:.14,rng:.85,sg:true,pc:6},
  ],
  rifles:[
    {id:'carbine',nm:'CARBINE',price:5000,owned:false,ab:'Long Range',desc:'Accurate rifle',ammo:8,res:160,dmg:28,fr:.38,rt:2.8,spd:1100,spr:.018,rng:2.8},
    {id:'springfield',nm:'SPRINGFIELD',price:22000,owned:false,ab:'Marksman',desc:'Extreme range',ammo:5,res:80,dmg:58,fr:.70,rt:3.2,spd:1300,spr:.008,rng:3.5},
    {id:'repeater',nm:'REPEATER',price:11000,owned:false,ab:'Rapid Lever',desc:'15-round lever',ammo:15,res:150,dmg:22,fr:.28,rt:3.5,spd:1050,spr:.025,rng:2.4},
  ],
};
const ALLG=[...GUNS.pistols,...GUNS.shotguns,...GUNS.rifles];

// ‚îÄ‚îÄ PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PRAD=14;
const P={
  x:0,y:80,angle:0,hp:100,maxHp:100,money:0,lv:1,xp:0,alive:true,name:'OUTLAW',
  reloading:false,reloadT:0,shootCD:0,dashCD:0,dashT:0,dvx:0,dvy:0,inv:0,
  gunId:'peacemaker',ammo:6,res:120,medkits:0,mkLv:5,
  get gun(){return ALLG.find(g=>g.id===this.gunId);}
};
function xpFor(l){return l*80+(l-1)*40;}
function addXP(a){
  P.xp+=a;const n=xpFor(P.lv);
  if(P.xp>=n){P.xp-=n;P.lv++;P.maxHp=100+(P.lv-1)*15;P.hp=Math.min(P.hp+30,P.maxHp);showFP('LEVEL '+P.lv+'!');spawnPolice();}
  uiLv();
}
function addMoney(a){P.money+=a;document.getElementById('hmv').textContent='$'+P.money.toLocaleString();}
let wanted=0,wDecay=0;const WDM=14;
function addWanted(n){wanted=Math.min(5,wanted+n);wDecay=WDM;uiWanted();}
function uiWanted(){document.getElementById('ws').textContent='‚òÖ'.repeat(wanted)+'‚òÜ'.repeat(5-wanted);}
function uiHp(){document.getElementById('hbf').style.width=(P.hp/P.maxHp*100)+'%';document.getElementById('hpn').textContent=Math.ceil(P.hp);}
function uiLv(){const n=xpFor(P.lv);document.getElementById('lvv').textContent='LVL '+P.lv;document.getElementById('xpf').style.width=(P.xp/n*100)+'%';document.getElementById('xpt').textContent=P.xp+'/'+n+' XP';}
function uiAmmo(){
  const el=document.getElementById('pp');el.innerHTML='';const g=P.gun;
  for(let i=0;i<g.ammo;i++){const d=document.createElement('div');d.className=(g.sg?'pip sg':'pip')+(i>=P.ammo?' e':'');el.appendChild(d);}
  document.getElementById('ar').textContent='/ '+P.res+' RESERVE';
}
function uiKits(){document.getElementById('hkv').textContent='‚úö '+P.medkits;document.getElementById('hkl').textContent=P.lv>=P.mkLv?'[F]USE':'LV'+P.mkLv+' REQ';}
let fkT,fbT,fpT,ftT;
function showFK(m){const e=document.getElementById('fk');e.textContent=m;e.style.opacity='1';clearTimeout(fkT);fkT=setTimeout(()=>e.style.opacity='0',1400);}
function showFB(m,c){const e=document.getElementById('fb');e.textContent=m;e.style.color=c||'#e8c87a';e.style.opacity='1';clearTimeout(fbT);fbT=setTimeout(()=>e.style.opacity='0',2200);}
function showFP(m){const e=document.getElementById('fp');e.textContent=m;e.style.opacity='1';clearTimeout(fpT);fpT=setTimeout(()=>e.style.opacity='0',2600);}
function showFT(m){const e=document.getElementById('ft');e.textContent=m;e.style.opacity='1';clearTimeout(ftT);ftT=setTimeout(()=>e.style.opacity='0',2200);}
let bsT=0;
function hitEffect(){bsT=.4;document.getElementById('bs').style.opacity='1';}
function damageP(a){if(P.inv>0||!P.alive)return;P.hp=Math.max(0,P.hp-a);hitEffect();cam.shake=Math.max(cam.shake,10);uiHp();if(P.hp<=0){P.alive=false;gameOn=false;setTimeout(showDead,1200);}}
function showDead(){const pen=~~(P.money*.05);P.money=Math.max(0,P.money-pen);document.getElementById('dsub').textContent='LEVEL '+P.lv+' ‚Äî $'+P.money.toLocaleString()+' REMAINING';document.getElementById('dpen').textContent='LOST $'+pen.toLocaleString()+' (5% PENALTY)';document.getElementById('dead').style.display='flex';}
function useMedkit(){if(!P.alive||!gameOn)return;if(!P.medkits){showFK('NO MEDKITS');return;}if(P.hp>=P.maxHp){showFK('ALREADY FULL');return;}P.medkits--;P.hp=Math.min(P.maxHp,P.hp+50);uiHp();uiKits();showFB('+50 HP','#44aa44');}

// ‚îÄ‚îÄ WORLD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TOWNS=[
  {name:'DUSTY CREEK',sub:'POPULATION: DWINDLING',x:0,y:0,r:420,
   blds:[
    {x:-280,y:-200,w:120,h:80,lb:'SALOON',c:'#8B5E3C',rf:'#5A3520'},
    {x:160,y:-200,w:110,h:80,lb:'SHERIFF',c:'#7A5030',rf:'#4A3018'},
    {x:-280,y:160,w:100,h:70,lb:'BANK',c:'#A07848',rf:'#6A4828'},
    {x:160,y:160,w:120,h:75,lb:'GENERAL\nSTORE',c:'#4a7038',rf:'#2a4820',isGen:true},
    {x:300,y:-50,w:100,h:70,lb:'GUN SHOP',c:'#5a4028',rf:'#3a2818',isShop:true},
    {x:-340,y:-50,w:85,h:55,lb:'DOCTOR',c:'#788070',rf:'#485048'},
    {x:-50,y:-290,w:80,h:60,lb:'CHURCH',c:'#9a8870',rf:'#6a5840'},
    {x:-50,y:270,w:100,h:60,lb:'STABLES',c:'#7A5030',rf:'#4A3018'},
   ]},
  {name:'RATTLESNAKE RIDGE',sub:'WHERE LAW ENDS',x:2600,y:500,r:370,
   blds:[
    {x:2450,y:360,w:115,h:75,lb:"OUTLAW'S\nDEN",c:'#5a2818',rf:'#3a1808'},
    {x:2750,y:360,w:95,h:70,lb:'ARMORY',c:'#4a4828',rf:'#2a2818',isShop:true},
    {x:2450,y:630,w:105,h:65,lb:'SALOON',c:'#8a4828',rf:'#5a2818'},
    {x:2750,y:630,w:108,h:70,lb:'GENERAL\nSTORE',c:'#4a7038',rf:'#2a4820',isGen:true},
    {x:2600,y:210,w:82,h:55,lb:'WATCHTOWER',c:'#6a5030',rf:'#4a3820'},
   ]},
  {name:'CROW HOLLOW',sub:'LAWLESS TERRITORY',x:800,y:2800,r:400,
   blds:[
    {x:650,y:2650,w:122,h:80,lb:'BOUNTY\nOFFICE',c:'#6a3820',rf:'#3a2010'},
    {x:950,y:2650,w:100,h:75,lb:'GUN SHOP',c:'#5a4028',rf:'#3a2818',isShop:true},
    {x:650,y:2940,w:118,h:70,lb:'UNDERTAKER',c:'#3a3838',rf:'#222428'},
    {x:950,y:2940,w:102,h:65,lb:'GENERAL\nSTORE',c:'#4a7038',rf:'#2a4820',isGen:true},
    {x:800,y:2480,w:90,h:60,lb:'FORT WATLEY',c:'#6a5038',rf:'#4a3828'},
   ]},
];
const FOREST={x:-750,y:650,w:1500,h:1300,name:'EMERALD VALLEY',sub:'UNTAMED WILDERNESS'};
const FTREES=[],FBUSHES=[],FGRASS=[];
(()=>{
  const rn=(a,b)=>a+Math.random()*(b-a);
  for(let i=0;i<90;i++)FTREES.push({x:FOREST.x+rn(50,FOREST.w-50),y:FOREST.y+rn(50,FOREST.h-50),r:rn(16,34),g1:~~rn(78,128),g2:~~rn(148,198),th:rn(22,38)});
  for(let i=0;i<150;i++)FBUSHES.push({x:FOREST.x+rn(12,FOREST.w-12),y:FOREST.y+rn(12,FOREST.h-12),r:rn(7,17),gv:~~rn(90,175)});
  for(let i=0;i<300;i++)FGRASS.push({x:FOREST.x+rn(0,FOREST.w),y:FOREST.y+rn(0,FOREST.h),len:rn(8,18),ang:rn(-.4,.4),gv:~~rn(88,158)});
})();
const TRACK=[{x:-1900,y:280},{x:-900,y:220},{x:0,y:80},{x:850,y:300},{x:1750,y:500},{x:2600,y:680},{x:3400,y:900}];
const TRAIN={t:0,spd:.007,x:0,y:0,ang:0,robbable:false,cd:0,ntf:false,ntfT:0};
function trkPos(t){const n=TRACK.length-1,si=Math.min(~~(t*n),n-1),lt=t*n-si,a=TRACK[si],b=TRACK[si+1];return{x:a.x+(b.x-a.x)*lt,y:a.y+(b.y-a.y)*lt,ang:Math.atan2(b.y-a.y,b.x-a.x)};}
const COLS=[];
function buildCols(){COLS.length=0;TOWNS.forEach(t=>t.blds.forEach(b=>COLS.push({x:b.x,y:b.y,w:b.w,h:b.h})));}
function ptRect(px,py,pr,rx,ry,rw,rh){const nx=Math.max(rx-rw/2,Math.min(px,rx+rw/2)),ny=Math.max(ry-rh/2,Math.min(py,ry+rh/2));return(px-nx)**2+(py-ny)**2<pr*pr;}
function resolveP(x,y,r){let nx=x,ny=y;for(const c of COLS){if(ptRect(nx,ny,r,c.x,c.y,c.w,c.h)){const dx=nx-c.x,dy=ny-c.y,ox=c.w/2+r-Math.abs(dx),oy=c.h/2+r-Math.abs(dy);if(ox<oy)nx+=ox*(Math.sign(dx)||1);else ny+=oy*(Math.sign(dy)||1);}}return[nx,ny];}
function bWall(bx,by){for(const c of COLS)if(Math.abs(bx-c.x)<c.w/2+3&&Math.abs(by-c.y)<c.h/2+3)return true;return false;}

// ‚îÄ‚îÄ NPCs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const NMS=['Jesse','Cole','Frank','Mae','Dutch','Arthur','Bill','Sadie','Hosea','Micah','Javier','Elias','Hank','Ned','Buck','Pete'];
const RLS=['Outlaw','Drifter','Gambler','Rustler','Gunslinger','Fugitive','Bandit','Renegade'];
const NCL=['#8B5E3C','#6B4020','#7A5030','#5A3518','#9a6838','#4a3018'];
const NHT=['#1a0d05','#2a1808','#0d0808','#201408'];
const NSK=['#c8a878','#b89060','#d0aa80','#c09060','#e0b888','#a87850'];
const CVN=['Mary','Tom','Grace','Sam','Clara','Ned'];
const CVR=['Widow','Farmer','Preacher','Doctor','Banker'];
const GNM=['BLOOD CANYON','DEADWOOD RIDERS','IRON SKULL','SNAKE RIVER'];
const GCL=['#8a1010','#1a4a1a','#1a1a6a','#6a3a1a'];
const GHT=['#1a0404','#041a04','#04041a','#1a0e04'];
const npcs=[],police=[],riders=[],respawnQ=[];
function bRange(){if(P.lv>=10)return[500,1000];if(P.lv>=5)return[200,600];return[1,500];}
function mkBounty(ti){
  const[mn,mx2]=bRange(),bounty=~~(Math.random()*(mx2-mn))+mn;
  const isG=Math.random()<.2,gi=~~(Math.random()*GNM.length);
  const t=TOWNS[ti],a=Math.random()*Math.PI*2,d=100+Math.random()*290;
  return{bounty,name:NMS[~~(Math.random()*NMS.length)]+' '+RLS[~~(Math.random()*RLS.length)],hp:Math.max(2,~~(bounty/28)),maxHp:Math.max(2,~~(bounty/28)),spd:55+bounty/9,dmg:4+~~(bounty/65),sr:Math.max(.65,2.4-bounty/240),isG,gi,gN:isG?GNM[gi]:null,gC:isG?GCL[gi]:null,gH:isG?GHT[gi]:null,x:t.x+Math.cos(a)*d,y:t.y+Math.sin(a)*d,ang:0,col:isG?GCL[gi]:NCL[~~(Math.random()*NCL.length)],hat:isG?GHT[gi]:NHT[~~(Math.random()*NHT.length)],skn:NSK[~~(Math.random()*NSK.length)],sz:12+~~(bounty/95),alive:true,hostile:false,hf:0,st:Math.random()*2,wt:2+Math.random()*4,wtx:t.x,wty:t.y,isBounty:true,isCiv:false,ti};}
function mkCiv(ti){const t=TOWNS[ti],a=Math.random()*Math.PI*2,d=45+Math.random()*130;return{name:CVN[~~(Math.random()*CVN.length)]+' the '+CVR[~~(Math.random()*CVR.length)],hp:2,maxHp:2,spd:78,dmg:3,sr:3.2,x:t.x+Math.cos(a)*d,y:t.y+Math.sin(a)*d,ang:0,col:['#d4607a','#404880','#808878','#1a1a2a'][~~(Math.random()*4)],hat:NHT[~~(Math.random()*NHT.length)],skn:NSK[~~(Math.random()*NSK.length)],sz:11,alive:true,hostile:false,hf:0,st:Math.random()*3,wt:3+Math.random()*4,wtx:t.x,wty:t.y,isBounty:false,isCiv:true,isG:false,ti};}
function buildNPCs(){npcs.length=0;TOWNS.forEach((_,ti)=>{for(let i=0;i<7;i++)npcs.push(mkBounty(ti));for(let i=0;i<4;i++)npcs.push(mkCiv(ti));});}
function spawnPolice(){const n=3+P.lv;for(let i=0;i<n;i++){const a=Math.random()*Math.PI*2,d=480+Math.random()*200;police.push({x:P.x+Math.cos(a)*d,y:P.y+Math.sin(a)*d,ang:0,hp:8+P.lv*2,maxHp:8+P.lv*2,spd:100+P.lv*5,dmg:10+P.lv*2,sr:1.4,st:Math.random()*1.5,alive:true,hf:0,sz:13});}showFP('DEPUTIES INCOMING!');}
function spawnRiders(npc){const cnt=Math.min(10,5+~~(npc.bounty/100));showFP((npc.gN||'GANG')+' RIDES OUT!');for(let i=0;i<cnt;i++){const a=Math.random()*Math.PI*2,d=500+Math.random()*260;riders.push({x:P.x+Math.cos(a)*d,y:P.y+Math.sin(a)*d,ang:0,hp:3+~~(npc.bounty/80),maxHp:3+~~(npc.bounty/80),spd:165+npc.bounty/6,dmg:8+~~(npc.bounty/60),sr:Math.max(.8,1.8-npc.bounty/600),st:Math.random()*2,alive:true,hf:0,sz:18,col:npc.gC||'#5a1010',hat:npc.gH||'#1a0404',gN:npc.gN});}}

// ‚îÄ‚îÄ TRAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updTrain(dt){
  if(TRAIN.cd>0){TRAIN.cd-=dt;return;}
  TRAIN.t=(TRAIN.t+TRAIN.spd*dt)%1;const p=trkPos(TRAIN.t);TRAIN.x=p.x;TRAIN.y=p.y;TRAIN.ang=p.ang;
  const d=Math.hypot(P.x-TRAIN.x,P.y-TRAIN.y);
  TRAIN.robbable=d<130;
  if(d<420&&!TRAIN.ntf&&!TRAIN.robbable){TRAIN.ntf=true;showTrn('üöÇ TRAIN NEARBY!','Move to intercept');TRAIN.ntfT=4;}
  if(TRAIN.robbable&&!TRAIN.ntf){TRAIN.ntf=true;showTrn('üöÇ IN RANGE!','[ G ] ROB THE TRAIN');TRAIN.ntfT=5;}
  if(d>560)TRAIN.ntf=false;
  if(TRAIN.ntfT>0){TRAIN.ntfT-=dt;if(TRAIN.ntfT<=0)document.getElementById('trb').style.opacity='0';}
}
function showTrn(t,h){document.getElementById('trt').textContent=t;document.getElementById('trh').textContent=h;document.getElementById('trb').style.opacity='1';TRAIN.ntfT=5;}
function robTrain(){if(!TRAIN.robbable||!P.alive||!gameOn)return;const loot=~~(Math.random()*2000)+1;addMoney(loot);addXP(~~(loot/8)+10);addWanted(2);showFB('üöÇ ROBBED! +$'+loot,'#d08c18');showFT('DEPUTIES ALERTED!');document.getElementById('trb').style.opacity='0';TRAIN.cd=55+Math.random()*20;TRAIN.t=0;TRAIN.ntf=false;spawnPolice();}

// ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PARTS=[];
function pBlood(x,y,n){for(let i=0;i<n;i++){const a=Math.random()*Math.PI*2,s=40+Math.random()*160;PARTS.push({t:0,x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,r:2+Math.random()*4,life:1,c:`hsl(${~~(Math.random()*18)},90%,${18+~~(Math.random()*12)}%)`});}}
function pDust(x,y){for(let i=0;i<4;i++){const a=Math.random()*Math.PI*2,s=15+Math.random()*45;PARTS.push({t:1,x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,r:2+Math.random()*5,life:1});}}
function pMuzz(x,y,a){for(let i=0;i<4;i++){const aa=a+(Math.random()-.5)*.5,s=80+Math.random()*175;PARTS.push({t:2,x,y,vx:Math.cos(aa)*s,vy:Math.sin(aa)*s,r:2+Math.random()*4,life:.28});}}
function pCasing(x,y,a){PARTS.push({t:3,x,y,vx:Math.cos(a+Math.PI/2)*(25+Math.random()*60),vy:Math.sin(a+Math.PI/2)*(25+Math.random()*60),r:3,life:.65,ag:Math.random()*Math.PI*2,sp:(Math.random()-.5)*11});}
function pPool(x,y){PARTS.push({t:4,x,y,r:0,mr:8+Math.random()*18,life:28});}
function pExp(x,y){for(let i=0;i<24;i++){const a=Math.random()*Math.PI*2,s=80+Math.random()*230;PARTS.push({t:5,x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,r:3+Math.random()*6,life:.55});}PARTS.push({t:6,x,y,r:5,mr:80,life:.38});}
function pHoof(x,y){for(let i=0;i<3;i++){const a=Math.random()*Math.PI*2,s=20+Math.random()*38;PARTS.push({t:1,x:x+(Math.random()-.5)*8,y:y+(Math.random()-.5)*8,vx:Math.cos(a)*s,vy:Math.sin(a)*s,r:2+Math.random()*5,life:.65});}}

// ‚îÄ‚îÄ SHOOTING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const bullets=[],eBullets=[];
let autoT=0,flashT=0;
function doShoot(){
  if(!P.alive||P.reloading||!gameOn)return;const g=P.gun;if(P.ammo<=0){startReload();return;}if(P.shootCD>0)return;
  P.ammo--;P.shootCD=g.fr;uiAmmo();
  const bx=P.x+Math.cos(P.angle)*22,by=P.y+Math.sin(P.angle)*22;
  if(g.sg){const pc=g.pc||8;for(let i=0;i<pc;i++){const sp=(Math.random()-.5)*g.spr;bullets.push({x:bx,y:by,vx:Math.cos(P.angle+sp)*g.spd,vy:Math.sin(P.angle+sp)*g.spd,life:g.rng,tr:[],dmg:~~(g.dmg/pc)+2,sg:true});}mpShoot({sg:true,x:~~bx,y:~~by,a:P.angle,spd:g.spd,spr:g.spr,dmg:~~(g.dmg/pc)+2,pc});}
  else{const sp=(Math.random()-.5)*g.spr,vx=Math.cos(P.angle+sp)*g.spd,vy=Math.sin(P.angle+sp)*g.spd;bullets.push({x:bx,y:by,vx,vy,life:g.rng,tr:[],dmg:g.dmg,sp:g.sp||null});mpShoot({sg:false,x:~~bx,y:~~by,vx:~~vx,vy:~~vy,life:g.rng,dmg:g.dmg});if(g.sp==='burst')setTimeout(()=>{if(!P.alive||P.ammo<=0)return;P.ammo--;uiAmmo();const s2=(Math.random()-.5)*g.spr;bullets.push({x:bx,y:by,vx:Math.cos(P.angle+s2)*g.spd,vy:Math.sin(P.angle+s2)*g.spd,life:g.rng,tr:[],dmg:g.dmg});},80);}
  pMuzz(bx,by,P.angle);pCasing(P.x,P.y,P.angle);cam.shake=Math.max(cam.shake,g.sg?9:5);flashT=.07;
  if(P.ammo===0)setTimeout(startReload,350);
}
function onRMB(){if(!P.alive||!gameOn)return;const g=P.gun;if(g.sp==='explosive'){const bx=P.x+Math.cos(P.angle)*22,by=P.y+Math.sin(P.angle)*22;bullets.push({x:bx,y:by,vx:Math.cos(P.angle)*375,vy:Math.sin(P.angle)*375,life:.9,tr:[],dmg:0,sp:'explode'});cam.shake=9;flashT=.1;}else if(g.sg){if(P.ammo>=2){doShoot();setTimeout(doShoot,50);}else if(P.ammo>=1)doShoot();}else startReload();}
function startReload(){const g=P.gun;if(P.reloading||P.res<=0||P.ammo===g.ammo)return;P.reloading=true;P.reloadT=g.rt;document.getElementById('rlw').style.opacity='1';const rf=document.getElementById('rlf');rf.style.transition='width '+g.rt+'s linear';rf.style.width='100%';}
function finishReload(){P.reloading=false;document.getElementById('rlw').style.opacity='0';const rf=document.getElementById('rlf');rf.style.transition='none';rf.style.width='0%';const g=P.gun,n=g.ammo-P.ammo,l=Math.min(n,P.res);P.ammo+=l;P.res-=l;uiAmmo();}
function equipGun(id){const g=ALLG.find(g=>g.id===id);if(!g)return;P.gunId=id;P.ammo=g.ammo;P.res=g.res;P.reloading=false;document.getElementById('gn').textContent=g.nm;document.getElementById('ga').textContent=g.ab;uiAmmo();}

// ‚îÄ‚îÄ SHOPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let shopTab='pistols';
function tryInteract(){if(!P.alive||shopOpen||gstOpen)return;for(const t of TOWNS)for(const b of t.blds){if(Math.abs(P.x-b.x)<b.w/2+65&&Math.abs(P.y-b.y)<b.h/2+65){if(b.isShop){openShop();return;}if(b.isGen){openGStore();return;}}}}
function setTab(t,el){shopTab=t;document.querySelectorAll('.stab').forEach(e=>e.classList.remove('on'));el.classList.add('on');renderShop();}
function openShop(){shopOpen=true;document.getElementById('gso').style.display='flex';document.getElementById('gsm').textContent='MONEY: $'+P.money.toLocaleString();renderShop();}
function renderShop(){
  const guns=GUNS[shopTab],grid=document.getElementById('gsgrid');grid.innerHTML='';
  guns.forEach(g=>{
    const owned=g.owned,eq=P.gunId===g.id,can=P.money>=g.price;
    const card=document.createElement('div');card.className='gc'+(eq?' eq':'')+(owned||can?'':' lk');
    const cv=document.createElement('canvas');cv.className='gpx';cv.width=72;cv.height=44;
    const cx=cv.getContext('2d');cx.fillStyle='#040201';cx.fillRect(0,0,72,44);
    const grd=cx.createRadialGradient(36,26,0,36,26,24);grd.addColorStop(0,eq?'rgba(175,115,18,.16)':owned?'rgba(45,110,45,.12)':'rgba(25,15,4,.07)');grd.addColorStop(1,'rgba(0,0,0,0)');cx.fillStyle=grd;cx.fillRect(0,0,72,44);
    const rows=GPX[g.id],pw=rows?rows[0].length:14;drawGunPx(cx,g.id,Math.max(1,~~((72-pw*4)/2)),6,4);
    if(eq){cx.strokeStyle='rgba(175,115,18,.42)';cx.lineWidth=1.5;cx.strokeRect(.5,.5,71,43);}
    card.appendChild(cv);
    const pr=g.price===0?'FREE':can||owned?'$'+g.price.toLocaleString():`<span style="color:#783018">$${g.price.toLocaleString()}</span>`;
    card.innerHTML+=`<div class="gn">${g.nm}</div><div class="gd">${g.desc}</div><div class="gst"><div>DMG<span>${g.dmg}</span></div><div>AMO<span>${g.ammo}</span></div><div>SPD<span>${g.fr>.5?'SLW':g.fr>.3?'MED':'FST'}</span></div><div>RNG<span>${g.rng>2.5?'LNG':g.rng>1.2?'MED':'SHT'}</span></div></div>${owned?`<div class="gp" style="color:#3e983e">OWNED</div>`:`<div class="gp">${pr}</div>`}`;
    if(eq)card.innerHTML+=`<div class="gbdg e">EQ</div>`;else if(owned)card.innerHTML+=`<div class="gbdg o">OWN</div>`;
    if(!card.classList.contains('lk'))card.addEventListener('click',()=>{if(eq)return;if(owned){equipGun(g.id);openShop();return;}if(!can){showFB('NOT ENOUGH $','#c83018');return;}P.money-=g.price;g.owned=true;equipGun(g.id);document.getElementById('hmv').textContent='$'+P.money.toLocaleString();showFB('NEW GUN: '+g.nm);openShop();});
    grid.appendChild(card);
  });
}
function closeShop(){shopOpen=false;document.getElementById('gso').style.display='none';}
function openGStore(){gstOpen=true;document.getElementById('sto').style.display='flex';document.getElementById('stom').textContent='MONEY: $'+P.money.toLocaleString()+' | KITS: '+P.medkits;const con=document.getElementById('stolist');con.innerHTML='';const items=[{ok:P.lv>=P.mkLv,icon:'üè•',nm:'MEDKIT',desc:'+50 HP instantly',req:P.lv>=P.mkLv?'Available':'Level '+P.mkLv+' req',price:2500,fn(){if(P.money<2500){showFB('NOT ENOUGH $','#c83018');return;}P.money-=2500;P.medkits++;P.mkLv=P.lv+2;document.getElementById('hmv').textContent='$'+P.money.toLocaleString();uiKits();showFB('‚úö MEDKIT','#44aa44');openGStore();}},{ok:true,icon:'ü•É',nm:'WHISKEY',desc:'+15 HP now',req:'Always available',price:150,fn(){if(P.money<150){showFB('NOT ENOUGH $','#c83018');return;}P.money-=150;P.hp=Math.min(P.maxHp,P.hp+15);uiHp();document.getElementById('hmv').textContent='$'+P.money.toLocaleString();showFB('+15 HP','#988018');closeGStore();}},{ok:true,icon:'üî´',nm:'AMMO PACK',desc:'Refills reserve',req:'Always available',price:500,fn(){if(P.money<500){showFB('NOT ENOUGH $','#c83018');return;}P.money-=500;P.res=P.gun.res;uiAmmo();document.getElementById('hmv').textContent='$'+P.money.toLocaleString();showFB('AMMO FULL','#c8a018');closeGStore();}}];items.forEach(it=>{const d=document.createElement('div');d.className='si'+(it.ok?'':' sd');d.innerHTML=`<div class="sic">${it.icon}</div><div class="sin"><h3>${it.nm}</h3><p>${it.desc}</p><div class="sir">${it.req}</div></div><div class="sip">$${it.price.toLocaleString()}</div>`;if(it.ok)d.addEventListener('click',it.fn);con.appendChild(d);});}
function closeGStore(){gstOpen=false;document.getElementById('sto').style.display='none';}

// ‚îÄ‚îÄ TIME OF DAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let tod=0.38;
function lm(){const t=tod;if(t<.2||t>.82)return{r:.25,g:.2,b:.34};if(t<.3)return{r:.78,g:.48,b:.28};if(t<.62)return{r:1,g:.87,b:.64};return{r:.84,g:.44,b:.19};}

// ‚îÄ‚îÄ RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawSky(){
  const t=tod;let top,bot;
  if(t<.2||t>.82){top='#030208';bot='#070310';}else if(t<.27){top='#1e0810';bot='#5c1825';}else if(t<.36){top='#4e1e0e';bot='#be5425';}else if(t<.62){top='#283e5e';bot='#885418';}else if(t<.72){top='#381608';bot='#9e3518';}else{top='#090408';bot='#160508';}
  const g=X.createLinearGradient(0,0,0,H);g.addColorStop(0,top);g.addColorStop(1,bot);X.fillStyle=g;X.fillRect(0,0,W,H);
  // Sun
  const sa=tod*Math.PI*2-Math.PI/2,sh=Math.max(0,Math.min(1,1-Math.abs(tod-.3)*3.4));
  if(sh>.04){const[sx2,sy2]=ws(Math.cos(sa)*560,Math.sin(sa)*420);X.fillStyle=`rgba(255,238,155,${sh})`;X.shadowColor='rgba(255,195,70,.7)';X.shadowBlur=26;X.beginPath();X.arc(sx2,sy2,17,0,Math.PI*2);X.fill();X.shadowBlur=0;}
  // Moon
  const ma=sa+Math.PI,mh=Math.max(0,Math.min(1,(-Math.cos(ma+Math.PI)*.5+.5)));
  if(mh>.1){const[mx2,my2]=ws(Math.cos(ma)*560,Math.sin(ma)*420);X.fillStyle=`rgba(208,218,238,${mh*.72})`;X.beginPath();X.arc(mx2,my2,11,0,Math.PI*2);X.fill();}
}

function drawGround(){
  const L=lm(),tile=90;
  const ox=((cam.x%tile)+tile)%tile,oy=((cam.y%tile)+tile)%tile;
  const cols=Math.ceil(W/tile)+2,rows=Math.ceil(H/tile)+2;
  // Forest base
  const[fsx,fsy]=ws(FOREST.x,FOREST.y),[fex,fey]=ws(FOREST.x+FOREST.w,FOREST.y+FOREST.h);
  X.fillStyle=`rgb(${~~(30*L.r)},${~~(60*L.g)},${~~(18*L.b)})`;X.fillRect(fsx,fsy,fex-fsx,fey-fsy);
  // OLD SCHOOL TILE GRID ‚Äî simple hash-based dirt
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    const wx=cam.x-ox+c*tile,wy=cam.y-oy+r*tile;
    if(wx>FOREST.x&&wx<FOREST.x+FOREST.w&&wy>FOREST.y&&wy<FOREST.y+FOREST.h)continue;
    const h=((c*7+r*13)^c*3)%10,bv=h%3===0?.43:h%3===1?.37:.46;
    X.fillStyle=`rgb(${~~(bv*250*L.r)},${~~(bv*155*L.g)},${~~(bv*55*L.b)})`;
    X.fillRect(-ox+cam.sx+c*tile,-oy+cam.sy+r*tile,tile,tile);
  }
  // Tile grid lines
  X.strokeStyle='rgba(0,0,0,.045)';X.lineWidth=1;
  for(let r=0;r<=rows;r++){X.beginPath();X.moveTo(0,-oy+cam.sy+r*tile);X.lineTo(W,-oy+cam.sy+r*tile);X.stroke();}
  for(let c=0;c<=cols;c++){X.beginPath();X.moveTo(-ox+cam.sx+c*tile,0);X.lineTo(-ox+cam.sx+c*tile,H);X.stroke();}
  // Roads
  [[TOWNS[0],TOWNS[1]],[TOWNS[0],TOWNS[2]]].forEach(([a,b])=>{
    const[ax,ay]=ws(a.x,a.y),[bx,by]=ws(b.x,b.y);
    X.strokeStyle=`rgba(${~~(.43*255*L.r)},${~~(.24*200*L.g)},${~~(.07*200*L.b)},.9)`;X.lineWidth=20;X.setLineDash([]);X.beginPath();X.moveTo(ax,ay);X.lineTo(bx,by);X.stroke();
    X.strokeStyle=`rgba(${~~(.35*255*L.r)},${~~(.17*200*L.g)},${~~(.05*200*L.b)},.42)`;X.lineWidth=1.5;X.setLineDash([14,16]);X.beginPath();X.moveTo(ax,ay);X.lineTo(bx,by);X.stroke();X.setLineDash([]);
  });
  // Forest grass + bushes + trees
  FGRASS.forEach(g=>{const[sx,sy]=ws(g.x,g.y);if(sx<-4||sx>W+4||sy<-4||sy>H+4)return;X.strokeStyle=`rgb(${~~(g.gv*.48*L.r)},${~~(g.gv*L.g)},${~~(g.gv*.2*L.b)})`;X.lineWidth=1.1;X.beginPath();X.moveTo(sx,sy);X.lineTo(sx+Math.sin(g.ang)*g.len,sy-g.len);X.stroke();});
  FBUSHES.forEach(b=>{const[sx,sy]=ws(b.x,b.y);if(sx<-40||sx>W+40||sy<-40||sy>H+40)return;X.fillStyle=`rgba(${~~(b.gv*.36*L.r)},${~~(b.gv*L.g)},${~~(b.gv*.17*L.b)},.74)`;X.beginPath();X.arc(sx,sy,b.r,0,Math.PI*2);X.fill();X.fillStyle=`rgba(${~~(b.gv*.46*L.r)},${~~((b.gv+26)*L.g)},${~~(b.gv*.21*L.b)},.54)`;X.beginPath();X.arc(sx-b.r*.3,sy-b.r*.27,b.r*.6,0,Math.PI*2);X.fill();});
  FTREES.forEach(tr=>{const[sx,sy]=ws(tr.x,tr.y);if(sx<-80||sx>W+80||sy<-80||sy>H+80)return;X.fillStyle=`rgb(${~~(76*L.r)},${~~(46*L.g)},${~~(17*L.b)})`;X.fillRect(sx-4,sy,8,tr.th);X.fillStyle='rgba(0,0,0,.16)';X.beginPath();X.ellipse(sx+3,sy+3,tr.r,tr.r*.37,0,0,Math.PI*2);X.fill();X.fillStyle=`rgb(${~~(tr.g1*.42*L.r)},${~~(tr.g1*L.g)},${~~(tr.g1*.22*L.b)})`;X.beginPath();X.arc(sx,sy-tr.r*.27,tr.r,0,Math.PI*2);X.fill();X.fillStyle=`rgb(${~~(tr.g2*.42*L.r)},${~~(tr.g2*L.g)},${~~(tr.g2*.25*L.b)})`;X.beginPath();X.arc(sx-tr.r*.22,sy-tr.r*.52,tr.r*.67,0,Math.PI*2);X.fill();});
}

function drawTracks(){
  const L=lm();
  X.strokeStyle=`rgba(${~~(88*L.r)},${~~(60*L.g)},${~~(30*L.b)},.63)`;X.lineWidth=5;X.setLineDash([20,10]);
  X.beginPath();TRACK.forEach((p,i)=>{const[sx,sy]=ws(p.x,p.y);i===0?X.moveTo(sx,sy):X.lineTo(sx,sy);});X.stroke();X.setLineDash([]);
  TRACK.forEach((p,i)=>{if(i===TRACK.length-1)return;const np=TRACK[i+1],dx=np.x-p.x,dy=np.y-p.y,l=Math.hypot(dx,dy),nx=dy/l*5,ny=-dx/l*5;const[sx,sy]=ws(p.x,p.y),[ex,ey]=ws(np.x,np.y);[-1,1].forEach(s=>{X.strokeStyle=`rgba(${~~(102*L.r)},${~~(80*L.g)},${~~(53*L.b)},.78)`;X.lineWidth=1.8;X.setLineDash([]);X.beginPath();X.moveTo(sx+nx*s,sy+ny*s);X.lineTo(ex+nx*s,ey+ny*s);X.stroke();});});
}

function drawTrain(){
  const L=lm(),[tsx,tsy]=ws(TRAIN.x,TRAIN.y);if(tsx<-200||tsx>W+200||tsy<-200||tsy>H+200)return;
  X.save();X.translate(tsx,tsy);X.rotate(TRAIN.ang);
  const nc=5,cl=37,cw=20,gap=6;
  for(let i=0;i<nc;i++){const cx=-(cl+gap)*(nc-1)/2+(cl+gap)*i;X.fillStyle='rgba(0,0,0,.2)';X.fillRect(cx-cl/2+3,-cw/2+3,cl,cw);X.fillStyle=i===0?`rgb(${~~(92*L.r)},${~~(26*L.g)},${~~(11*L.b)})`:`rgb(${~~(50*L.r)},${~~(37*L.g)},${~~(27*L.b)})`;X.fillRect(cx-cl/2,-cw/2,cl,cw);X.fillStyle='rgba(0,0,0,.27)';X.fillRect(cx-cl/2,-cw/2,cl,4);if(i>0){X.fillStyle='rgba(175,210,238,.3)';X.fillRect(cx-cl*.29,-4,cl*.23,8);X.fillRect(cx+cl*.06,-4,cl*.23,8);}for(const wy of[-1,1])for(const wx of[-.32,.32]){X.fillStyle=`rgb(${~~(53*L.r)},${~~(39*L.g)},${~~(24*L.b)})`;X.beginPath();X.arc(cx+wx*cl,wy*(cw/2+2),5,0,Math.PI*2);X.fill();}if(i===0){X.fillStyle=`rgb(${~~(118*L.r)},${~~(72*L.g)},${~~(17*L.b)})`;X.fillRect(cx+cl*.22,-4,7,8);}}
  for(let i=0;i<3;i++){const pf=Math.sin(Date.now()/175+i)*.4;X.fillStyle=`rgba(215,215,215,${.21-i*.06})`;X.beginPath();X.arc(-(cl+gap)*(nc-1)/2-cl*.4,-(cw/2+7+i*6+pf*3),3.5+i*3,0,Math.PI*2);X.fill();}
  X.restore();
  if(TRAIN.robbable){X.fillStyle='rgba(4,2,1,.88)';X.fillRect(tsx-44,tsy-34,88,16);X.fillStyle='#c88c18';X.font='bold 7px Georgia';X.textAlign='center';X.textBaseline='middle';X.fillText('[ G ] ROB',tsx,tsy-26);}
}

function drawBuilding(b){
  const L=lm(),[sx,sy]=ws(b.x,b.y),hw=b.w/2,hh=b.h/2;if(sx+hw<-10||sx-hw>W+10||sy+hh<-10||sy-hh>H+10)return;
  const sh=col=>{const r=parseInt(col.slice(1,3),16),g=parseInt(col.slice(3,5),16),bl=parseInt(col.slice(5,7),16);return`rgb(${~~(r*L.r)},${~~(g*L.g)},${~~(bl*L.b)})`;};
  X.fillStyle='rgba(0,0,0,.17)';X.fillRect(sx-hw+5,sy-hh+7,b.w,b.h);
  X.fillStyle=sh(b.c);X.fillRect(sx-hw,sy-hh,b.w,b.h);
  for(let i=1;i<4;i++){X.strokeStyle='rgba(0,0,0,.065)';X.lineWidth=1;X.beginPath();X.moveTo(sx-hw,sy-hh+i*b.h/4);X.lineTo(sx+hw,sy-hh+i*b.h/4);X.stroke();}
  X.fillStyle=sh(b.rf);X.fillRect(sx-hw-5,sy-hh,b.w+10,12);
  X.fillStyle='rgba(0,0,0,.5)';X.fillRect(sx-8,sy+hh-22,16,22);X.strokeStyle='rgba(195,145,55,.3)';X.lineWidth=1.5;X.strokeRect(sx-8,sy+hh-22,16,22);
  [[sx-hw+17,sy-hh+27],[sx+hw-27,sy-hh+27]].forEach(([wx,wy])=>{if(Math.abs(wx-sx)<hw-5){X.fillStyle='rgba(195,175,78,.13)';X.fillRect(wx-9,wy-8,18,16);X.strokeStyle='rgba(145,118,48,.3)';X.lineWidth=1;X.strokeRect(wx-9,wy-8,18,16);}});
  X.fillStyle='rgba(4,2,1,.67)';X.fillRect(sx-b.w*.34,sy-hh+13,b.w*.68,12);
  X.fillStyle=b.isShop?'#ffce50':b.isGen?'#56be56':'#e8c87a';X.font='bold 7px Georgia';X.textAlign='center';X.textBaseline='middle';
  b.lb.split('\n').forEach((ln,i)=>X.fillText(ln,sx,sy-hh+18+i*8));
  const near=Math.abs(P.x-b.x)<b.w/2+68&&Math.abs(P.y-b.y)<b.h/2+68;
  if(near&&(b.isShop||b.isGen)){X.fillStyle='rgba(252,200,42,.8)';X.font='7px Georgia';X.textAlign='center';X.fillText(b.isShop?'[ E ] GUN SHOP':'[ E ] GENERAL STORE',sx,sy+hh+15);}
}

function drawNPC(n){
  if(!n.alive)return;const[sx,sy]=ws(n.x,n.y);if(sx<-100||sx>W+100||sy<-100||sy>H+100)return;
  const L=lm();X.save();X.translate(sx,sy);X.rotate(n.ang+Math.PI/2);
  if(n.hf>0){X.shadowColor='#ff2c2c';X.shadowBlur=17;}
  X.fillStyle='rgba(0,0,0,.17)';X.beginPath();X.ellipse(2,4,n.sz,n.sz*.4,0,0,Math.PI*2);X.fill();
  const cr=parseInt(n.col.slice(1,3),16),cg=parseInt(n.col.slice(3,5),16),cb=parseInt(n.col.slice(5,7),16);
  X.fillStyle=n.hf>0?'hsl(0,78%,31%)':`rgb(${~~(cr*L.r)},${~~(cg*L.g)},${~~(cb*L.b)})`;X.beginPath();X.arc(0,0,n.sz,0,Math.PI*2);X.fill();
  X.fillStyle=n.skn;X.beginPath();X.arc(0,-n.sz*.1,n.sz*.54,0,Math.PI*2);X.fill();
  X.fillStyle=n.hat;X.beginPath();X.ellipse(0,-n.sz*.65,n.sz*.71,n.sz*.2,0,0,Math.PI*2);X.fill();X.fillRect(-n.sz*.41,-n.sz-2,n.sz*.82,n.sz*.64);
  if(n.isG&&n.gC){const gc=parseInt(n.gC.slice(1,3),16),gg=parseInt(n.gC.slice(3,5),16),gbl=parseInt(n.gC.slice(5,7),16);X.fillStyle=`rgb(${~~(Math.min(255,gc+38)*L.r)},${~~(Math.min(255,gg+38)*L.g)},${~~(Math.min(255,gbl+38)*L.b)})`;X.beginPath();X.arc(0,n.sz*.29,n.sz*.44,0,Math.PI);X.fill();}
  X.fillStyle='#1c1816';X.fillRect(n.sz*.54,-3,n.sz*.83,5);X.shadowBlur=0;
  if(n.hp<n.maxHp){X.fillStyle='rgba(0,0,0,.5)';X.fillRect(-n.sz,-n.sz-10,n.sz*2,4);X.fillStyle=`hsl(${n.hp/n.maxHp*110},78%,37%)`;X.fillRect(-n.sz,-n.sz-10,n.sz*2*(n.hp/n.maxHp),4);}
  X.restore();
  if(n.isBounty){const cl=Math.hypot(P.x-n.x,P.y-n.y)<300,tw=64,th=16,tx=sx-tw/2,ty=sy-n.sz-26;X.save();X.globalAlpha=cl?1:.56;X.fillStyle='rgba(6,3,1,.92)';X.fillRect(tx,ty,tw,th);X.strokeStyle=n.hostile?'rgba(205,33,16,.62)':n.isG?'rgba(165,68,68,.4)':'rgba(165,118,33,.4)';X.lineWidth=1;X.strokeRect(tx,ty,tw,th);X.fillStyle=n.bounty>=300?'#ff7412':n.bounty>=150?'#e4b814':'#c29c35';X.font='bold 9px Georgia';X.textAlign='center';X.textBaseline='middle';X.fillText('$'+n.bounty,sx,ty+8);X.globalAlpha=1;X.restore();}
}

function drawPolice(p){
  if(!p.alive)return;const[sx,sy]=ws(p.x,p.y);if(sx<-80||sx>W+80||sy<-80||sy>H+80)return;
  const L=lm();X.save();X.translate(sx,sy);X.rotate(p.ang+Math.PI/2);
  if(p.hf>0){X.shadowColor='#3a74e8';X.shadowBlur=13;}
  X.fillStyle='rgba(0,0,0,.17)';X.beginPath();X.ellipse(2,4,p.sz,p.sz*.4,0,0,Math.PI*2);X.fill();
  X.fillStyle=p.hf>0?'hsl(220,78%,48%)':`rgb(${~~(50*L.r)},${~~(80*L.g)},${~~(118*L.b)})`;X.beginPath();X.arc(0,0,p.sz,0,Math.PI*2);X.fill();
  X.fillStyle='#bc8e6c';X.beginPath();X.arc(0,-p.sz*.1,p.sz*.54,0,Math.PI*2);X.fill();
  X.fillStyle=`rgb(${~~(25*L.r)},${~~(43*L.g)},${~~(72*L.b)})`;X.beginPath();X.ellipse(0,-p.sz*.65,p.sz*.71,p.sz*.2,0,0,Math.PI*2);X.fill();X.fillRect(-p.sz*.41,-p.sz-2,p.sz*.82,p.sz*.64);
  X.fillStyle='#e6cc58';X.shadowColor='#ffd700';X.shadowBlur=5;X.beginPath();for(let i=0;i<5;i++){const a=i*Math.PI*.4-Math.PI/2;X.lineTo(Math.cos(a)*5,Math.sin(a)*5+2);X.lineTo(Math.cos(a+Math.PI*.2)*2,Math.sin(a+Math.PI*.2)*2+2);}X.closePath();X.fill();X.shadowBlur=0;
  X.fillStyle='#1c1816';X.fillRect(p.sz*.54,-3,p.sz*.83,5);
  if(p.hp<p.maxHp){X.fillStyle='rgba(0,0,0,.5)';X.fillRect(-p.sz,-p.sz-10,p.sz*2,4);X.fillStyle='#3674e8';X.fillRect(-p.sz,-p.sz-10,p.sz*2*(p.hp/p.maxHp),4);}
  X.restore();
  X.fillStyle='rgba(4,2,1,.72)';X.fillRect(sx-21,sy-p.sz-22,42,12);X.fillStyle='#3674e8';X.font='6px Georgia';X.textAlign='center';X.textBaseline='middle';X.fillText('DEPUTY',sx,sy-p.sz-16);
}

function drawRider(r){
  if(!r.alive)return;const[sx,sy]=ws(r.x,r.y);if(sx<-120||sx>W+120||sy<-120||sy>H+120)return;
  const L=lm();X.save();X.translate(sx,sy);X.rotate(r.ang+Math.PI/2);
  if(r.hf>0){X.shadowColor='#ff2c2c';X.shadowBlur=17;}
  X.fillStyle=`rgb(${~~(83*L.r)},${~~(53*L.g)},${~~(23*L.b)})`;X.beginPath();X.ellipse(0,6,r.sz*.83,r.sz*.54,0,0,Math.PI*2);X.fill();
  X.fillStyle=`rgb(${~~(73*L.r)},${~~(46*L.g)},${~~(19*L.b)})`;X.beginPath();X.ellipse(0,-r.sz*.4,r.sz*.34,r.sz*.54,0,0,Math.PI*2);X.fill();
  X.strokeStyle=`rgb(${~~(63*L.r)},${~~(39*L.g)},${~~(14*L.b)})`;X.lineWidth=3;const lp=Date.now()/100;[[-7,0],[7,0],[-5,0],[5,0]].forEach(([ox],i)=>{const la=Math.sin(lp+i*1.5)*.3;X.beginPath();X.moveTo(ox,10);X.lineTo(ox+Math.sin(la)*8,10+Math.cos(la)*8);X.stroke();});
  const rc=parseInt(r.col.slice(1,3),16),rcg=parseInt(r.col.slice(3,5),16),rcb=parseInt(r.col.slice(5,7),16);
  X.fillStyle=r.hf>0?'hsl(0,78%,31%)':`rgb(${~~(rc*L.r)},${~~(rcg*L.g)},${~~(rcb*L.b)})`;X.beginPath();X.arc(0,-r.sz*.2,r.sz*.44,0,Math.PI*2);X.fill();
  X.fillStyle=r.hat;X.beginPath();X.ellipse(0,-r.sz*.74,r.sz*.49,r.sz*.14,0,0,Math.PI*2);X.fill();X.fillRect(-r.sz*.27,-r.sz-.4,r.sz*.54,r.sz*.49);
  X.fillStyle='#1c1816';X.fillRect(r.sz*.39,-4,r.sz*.69,5);X.shadowBlur=0;
  if(r.hp<r.maxHp){X.fillStyle='rgba(0,0,0,.5)';X.fillRect(-r.sz,-r.sz-10,r.sz*2,4);X.fillStyle='#c83418';X.fillRect(-r.sz,-r.sz-10,r.sz*2*(r.hp/r.maxHp),4);}
  X.restore();
}

function drawPlayer(){
  const[sx,sy]=ws(P.x,P.y),L=lm();X.save();X.translate(sx,sy);X.rotate(P.angle+Math.PI/2);
  if(P.dashT>0){X.globalAlpha=.27;X.fillStyle='#e8c87a';X.beginPath();X.arc(0,0,PRAD*2.2,0,Math.PI*2);X.fill();X.globalAlpha=1;}
  X.fillStyle='rgba(0,0,0,.19)';X.beginPath();X.ellipse(2,4,PRAD,PRAD*.4,0,0,Math.PI*2);X.fill();
  X.fillStyle=`rgb(${~~(184*L.r)},${~~(136*L.g)},${~~(88*L.b)})`;X.beginPath();X.arc(0,0,PRAD,0,Math.PI*2);X.fill();
  X.fillStyle=`rgb(${~~(50*L.r)},${~~(29*L.g)},${~~(12*L.b)})`;X.beginPath();X.arc(0,0,PRAD,Math.PI*.25,Math.PI*1.75);X.closePath();X.fill();
  X.fillStyle='#0e0805';X.beginPath();X.ellipse(0,-PRAD*.64,PRAD*.75,PRAD*.21,0,0,Math.PI*2);X.fill();X.fillRect(-PRAD*.42,-PRAD-2,PRAD*.84,PRAD*.67);
  if(flashT>0){X.fillStyle=`rgba(255,${122+~~(Math.random()*76)},0,${flashT/.07})`;X.shadowColor='#ff8a00';X.shadowBlur=13;X.beginPath();X.arc(PRAD*1.5,0,Math.random()*5+4,0,Math.PI*2);X.fill();X.shadowBlur=0;}
  X.restore();
}

function drawBullet(b,enemy){
  const[sx,sy]=ws(b.x,b.y);X.save();
  if(!b.sg&&b.tr.length>1){X.globalAlpha=.27;X.strokeStyle=enemy?'#ff3c1c':'#ffdc76';X.lineWidth=enemy?2:2.5;X.beginPath();const[tx,ty]=ws(b.tr[0][0],b.tr[0][1]);X.moveTo(tx,ty);b.tr.slice(1).forEach(t=>{const[x2,y2]=ws(t[0],t[1]);X.lineTo(x2,y2);});X.stroke();X.globalAlpha=1;}
  const exp=b.sp==='explode';X.fillStyle=exp?'#ff7c14':enemy?'#ff3c1c':'#ffdb58';X.shadowColor=exp?'#ff8800':enemy?'#ff1600':'#ffca00';X.shadowBlur=exp?13:6;X.beginPath();X.arc(sx,sy,exp?7:enemy?3.5:3.8,0,Math.PI*2);X.fill();X.restore();
}

function drawParts(){
  for(const p of PARTS){const[sx,sy]=ws(p.x,p.y);X.save();switch(p.t){case 0:X.fillStyle=p.c;X.globalAlpha=Math.min(1,p.life*2);X.beginPath();X.arc(sx,sy,p.r*Math.min(1,p.life*2),0,Math.PI*2);X.fill();break;case 1:X.globalAlpha=p.life*.36;X.fillStyle=`rgba(175,125,52,${p.life*.3})`;X.beginPath();X.arc(sx,sy,p.r,0,Math.PI*2);X.fill();break;case 2:X.globalAlpha=p.life/.28;X.fillStyle='#ffac14';X.shadowColor='#ff9400';X.shadowBlur=7;X.beginPath();X.arc(sx,sy,p.r*Math.max(.1,p.life/.28),0,Math.PI*2);X.fill();break;case 3:X.globalAlpha=Math.min(1,p.life/.65*2);X.fillStyle='#c49614';X.save();X.translate(sx,sy);X.rotate(p.ag);X.fillRect(-4,-2,8,4);X.restore();break;case 4:{const tr=p.r/p.mr;X.globalAlpha=Math.min(.5,tr*(p.life/28)*1.5);X.fillStyle='#4c0000';X.beginPath();X.ellipse(sx,sy,p.r,p.r*.5,0,0,Math.PI*2);X.fill();}break;case 5:X.fillStyle=`hsl(${16+Math.random()*26},100%,${46+Math.random()*27}%)`;X.globalAlpha=p.life/.55;X.shadowColor='#ff7400';X.shadowBlur=8;X.beginPath();X.arc(sx,sy,p.r,0,Math.PI*2);X.fill();break;case 6:X.strokeStyle=`rgba(252,142,16,${1-p.r/p.mr})`;X.lineWidth=4*(1-p.r/p.mr);X.beginPath();X.arc(sx,sy,p.r,0,Math.PI*2);X.stroke();break;}X.restore();}
}

// remote MP players
const REMOTES={};
function drawRemotes(){
  const L=lm();Object.values(REMOTES).forEach(r=>{if(!r.alive)return;const[sx,sy]=ws(r.x,r.y);if(sx<-80||sx>W+80||sy<-80||sy>H+80)return;X.save();X.translate(sx,sy);X.rotate((r.angle||0)+Math.PI/2);X.fillStyle='rgba(0,0,0,.17)';X.beginPath();X.ellipse(2,4,PRAD,PRAD*.4,0,0,Math.PI*2);X.fill();X.fillStyle=`rgb(${~~(198*L.r)},${~~(198*L.g)},${~~(72*L.b)})`;X.beginPath();X.arc(0,0,PRAD,0,Math.PI*2);X.fill();X.fillStyle='#0e0805';X.beginPath();X.ellipse(0,-PRAD*.64,PRAD*.75,PRAD*.21,0,0,Math.PI*2);X.fill();X.fillRect(-PRAD*.42,-PRAD-2,PRAD*.84,PRAD*.67);X.restore();X.fillStyle='rgba(3,2,1,.8)';X.fillRect(sx-28,sy-PRAD-23,56,13);X.fillStyle='#d8c038';X.font='7px Georgia';X.textAlign='center';X.textBaseline='middle';X.fillText(r.name||'?',sx,sy-PRAD-17);});
}

// minimap
function drawMinimap(){
  const S=.021,mw=146,mh=146;MX.fillStyle='rgba(4,2,1,.88)';MX.fillRect(0,0,mw,mh);
  const[fsx2,fsy2]=ws(FOREST.x,FOREST.y);MX.fillStyle='rgba(26,54,12,.58)';MX.fillRect(mw/2+(FOREST.x-cam.x)*S,mh/2+(FOREST.y-cam.y)*S,FOREST.w*S,FOREST.h*S);
  TOWNS.forEach(t=>{const tx=mw/2+(t.x-cam.x)*S,ty=mh/2+(t.y-cam.y)*S;MX.fillStyle='rgba(165,115,28,.26)';MX.beginPath();MX.arc(tx,ty,t.r*S,0,Math.PI*2);MX.fill();});
  MX.strokeStyle='rgba(108,86,48,.43)';MX.lineWidth=1;MX.setLineDash([3,4]);MX.beginPath();TRACK.forEach((p,i)=>{const tx=mw/2+(p.x-cam.x)*S,ty=mh/2+(p.y-cam.y)*S;i===0?MX.moveTo(tx,ty):MX.lineTo(tx,ty);});MX.stroke();MX.setLineDash([]);
  npcs.forEach(n=>{if(!n.alive)return;const nx=mw/2+(n.x-cam.x)*S,ny=mh/2+(n.y-cam.y)*S;MX.fillStyle=n.isBounty?'#be2614':'#384ebe';MX.beginPath();MX.arc(nx,ny,2.3,0,Math.PI*2);MX.fill();});
  police.forEach(p=>{if(!p.alive)return;const nx=mw/2+(p.x-cam.x)*S,ny=mh/2+(p.y-cam.y)*S;MX.fillStyle='#3674e8';MX.beginPath();MX.arc(nx,ny,2.3,0,Math.PI*2);MX.fill();});
  MX.font='9px serif';MX.fillText('üöÇ',mw/2+(TRAIN.x-cam.x)*S-4,mh/2+(TRAIN.y-cam.y)*S+4);
  Object.values(REMOTES).forEach(r=>{const rx=mw/2+(r.x-cam.x)*S,ry=mh/2+(r.y-cam.y)*S;MX.fillStyle='#d8c038';MX.beginPath();MX.arc(rx,ry,2.8,0,Math.PI*2);MX.fill();});
  MX.fillStyle='#e8c87a';MX.beginPath();MX.arc(mw/2,mh/2,4,0,Math.PI*2);MX.fill();
  MX.strokeStyle='rgba(135,88,16,.23)';MX.lineWidth=1;MX.strokeRect(0,0,mw,mh);
}

// location banner
let lastLoc='';
function checkLoc(){
  let loc=null;TOWNS.forEach(t=>{if(Math.hypot(P.x-t.x,P.y-t.y)<t.r)loc=t;});
  const inF=P.x>FOREST.x&&P.x<FOREST.x+FOREST.w&&P.y>FOREST.y&&P.y<FOREST.y+FOREST.h;
  const nm=loc?loc.name:inF?FOREST.name:'THE FRONTIER';
  if(nm!==lastLoc){lastLoc=nm;document.getElementById('ln').textContent=nm;document.getElementById('ls').textContent=loc?loc.sub:inF?FOREST.sub:'DANGEROUS OPEN LAND';const el=document.getElementById('lc');el.style.opacity='1';setTimeout(()=>el.style.opacity='0',3200);}
}

// ‚îÄ‚îÄ AI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function aiMove(e,dt){
  if(!e.alive)return;if(e.hf>0)e.hf-=dt;
  const dx=P.x-e.x,dy=P.y-e.y,d=Math.hypot(dx,dy);e.ang=Math.atan2(dy,dx);
  if(d>((e.sz||12)*2.5)){const s=(e.spd||80)*dt/d;e.x+=dx*s;e.y+=dy*s;const[rx,ry]=resolveP(e.x,e.y,e.sz||12);e.x=rx;e.y=ry;}
  e.st-=dt;if(e.st<=0&&d<490){e.st=(e.sr||2)*(Math.random()*.5+.75);const err=(Math.random()-.5)*.16;eBullets.push({x:e.x+Math.cos(e.ang)*(e.sz||12),y:e.y+Math.sin(e.ang)*(e.sz||12),vx:Math.cos(e.ang+err)*365,vy:Math.sin(e.ang+err)*365,life:1.5,tr:[],dmg:e.dmg||8});}
}
function killNPC(n){
  if(!n.alive)return;n.alive=false;pBlood(n.x,n.y,24);pPool(n.x,n.y);cam.shake=Math.max(cam.shake,6);
  if(n.isBounty){addMoney(n.bounty);const xpG=~~(n.bounty/4)+15;addXP(xpG);showFB('‚ò† +$'+n.bounty,'#dcc018');showFK('+$'+n.bounty+' | +'+xpG+'XP');if(n.isG)setTimeout(()=>spawnRiders(n),1500);addWanted(1);mpKill(n.x,n.y);const ti=n.ti;respawnQ.push({t:28+Math.random()*14,fn:()=>mkBounty(ti)});}
  else if(n.isCiv){addWanted(2);showFK('INNOCENT KILLED');addXP(2);const ti=n.ti;respawnQ.push({t:14,fn:()=>mkCiv(ti)});}
}

// ‚îÄ‚îÄ MAIN UPDATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function update(dt){
  if(!gameOn||!P.alive||shopOpen||gstOpen||chatOpen)return;
  tod=(tod+dt*.004)%1;
  mouse.wx=(mouse.x-CX)+cam.x;mouse.wy=(mouse.y-CY)+cam.y;P.angle=Math.atan2(mouse.wy-P.y,mouse.wx-P.x);
  autoT-=dt;if(mouse.dn&&autoT<=0&&!P.reloading){doShoot();autoT=P.gun.fr;}
  if(P.shootCD>0){P.shootCD-=dt;document.getElementById('cdf').style.width=((1-P.shootCD/P.gun.fr)*100)+'%';}else document.getElementById('cdf').style.width='100%';
  if(P.inv>0)P.inv-=dt;if(flashT>0)flashT-=dt;
  if(P.reloading){P.reloadT-=dt;if(P.reloadT<=0)finishReload();}
  if((K['ShiftLeft']||K['ShiftRight'])&&P.dashCD<=0&&P.dashT<=0){const dx=(K['KeyD']?1:0)-(K['KeyA']?1:0),dy=(K['KeyS']?1:0)-(K['KeyW']?1:0);if(dx||dy){const l=Math.hypot(dx,dy);P.dvx=dx/l*555;P.dvy=dy/l*555;P.dashT=.15;P.dashCD=.7;P.inv=.2;cam.shake=Math.max(cam.shake,4);}}
  if(P.dashCD>0)P.dashCD-=dt;
  let mx=0,my=0;
  if(P.dashT>0){P.dashT-=dt;mx=P.dvx;my=P.dvy;}
  else{if(K['KeyW']||K['ArrowUp'])my-=1;if(K['KeyS']||K['ArrowDown'])my+=1;if(K['KeyA']||K['ArrowLeft'])mx-=1;if(K['KeyD']||K['ArrowRight'])mx+=1;const ml=Math.hypot(mx,my)||1;if(mx||my){mx=mx/ml*200;my=my/ml*200;}}
  P.x+=mx*dt;P.y+=my*dt;[P.x,P.y]=resolveP(P.x,P.y,PRAD);
  cam.x+=(P.x-cam.x)*10*dt;cam.y+=(P.y-cam.y)*10*dt;
  if(cam.shake>0){cam.shake*=.7;if(cam.shake<.1)cam.shake=0;cam.sx=(Math.random()-.5)*cam.shake;cam.sy=(Math.random()-.5)*cam.shake;}else{cam.sx=0;cam.sy=0;}
  if(bsT>0){bsT-=dt;if(bsT<=0)document.getElementById('bs').style.opacity='0';}
  if(wanted>0){wDecay-=dt;document.getElementById('wdf').style.width=(wDecay/WDM*100)+'%';if(wDecay<=0){wanted--;wDecay=WDM;uiWanted();}}
  for(let i=respawnQ.length-1;i>=0;i--){respawnQ[i].t-=dt;if(respawnQ[i].t<=0){npcs.push(respawnQ[i].fn());respawnQ.splice(i,1);}}
  updTrain(dt);
  npcs.forEach(n=>{if(!n.alive)return;if(n.hf>0)n.hf-=dt;if(n.hostile)aiMove(n,dt);else{n.wt-=dt;if(n.wt<=0){n.wt=3+Math.random()*4;const t=TOWNS[n.ti];n.wtx=t.x+(Math.random()-.5)*290;n.wty=t.y+(Math.random()-.5)*290;}const wdx=n.wtx-n.x,wdy=n.wty-n.y,wd=Math.hypot(wdx,wdy);if(wd>15){const s=n.spd*.35*dt/wd;n.x+=wdx*s;n.y+=wdy*s;[n.x,n.y]=resolveP(n.x,n.y,n.sz);n.ang=Math.atan2(wdy,wdx);}}});
  police.forEach(p=>{if(p.alive)aiMove(p,dt);});riders.forEach(r=>{if(r.alive){aiMove(r,dt);if(Math.random()<.28)pHoof(r.x,r.y);}});
  // player bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];if(!b.sg){b.tr.push([b.x,b.y]);if(b.tr.length>6)b.tr.shift();}b.x+=b.vx*dt;b.y+=b.vy*dt;b.life-=dt;let hit=false;
    if(b.sp==='explode'){const near=npcs.some(n=>n.alive&&Math.hypot(b.x-n.x,b.y-n.y)<92)||police.some(p=>p.alive&&Math.hypot(b.x-p.x,b.y-p.y)<92)||riders.some(r=>r.alive&&Math.hypot(b.x-r.x,b.y-r.y)<92);if(near||bWall(b.x,b.y)||b.life<=0){pExp(b.x,b.y);cam.shake=Math.max(cam.shake,14);npcs.forEach(n=>{if(!n.alive)return;if(Math.hypot(b.x-n.x,b.y-n.y)<76){n.hp-=3;n.hf=.12;n.hostile=true;if(n.hp<=0)killNPC(n);}});police.forEach(p=>{if(!p.alive)return;if(Math.hypot(b.x-p.x,b.y-p.y)<76){p.hp-=4;p.hf=.12;if(p.hp<=0)p.alive=false;}});riders.forEach(r=>{if(!r.alive)return;if(Math.hypot(b.x-r.x,b.y-r.y)<76){r.hp-=4;r.hf=.12;if(r.hp<=0){r.alive=false;addXP(12);}}});bullets.splice(i,1);continue;}}
    for(let j=0;j<npcs.length&&!hit;j++){const n=npcs[j];if(!n.alive)continue;if(Math.hypot(b.x-n.x,b.y-n.y)<n.sz+5){n.hp-=b.dmg;n.hf=.13;pBlood(n.x,n.y,b.sg?4:8);cam.shake=Math.max(cam.shake,3);n.hostile=true;if(n.hp<=0)killNPC(n);hit=true;}}
    for(let j=0;j<police.length&&!hit;j++){const p=police[j];if(!p.alive)continue;if(Math.hypot(b.x-p.x,b.y-p.y)<p.sz+5){p.hp-=b.dmg;p.hf=.13;pBlood(p.x,p.y,5);cam.shake=Math.max(cam.shake,3);if(p.hp<=0){p.alive=false;addXP(15);showFK('DEPUTY DOWN');}hit=true;}}
    for(let j=0;j<riders.length&&!hit;j++){const r=riders[j];if(!r.alive)continue;if(Math.hypot(b.x-r.x,b.y-r.y)<r.sz+5){r.hp-=b.dmg;r.hf=.13;pBlood(r.x,r.y,5);cam.shake=Math.max(cam.shake,3);if(r.hp<=0){r.alive=false;addXP(12);showFK('RIDER DOWN');}hit=true;}}
    if(!hit&&bWall(b.x,b.y)){pDust(b.x,b.y);hit=true;}
    if(hit||b.life<=0)bullets.splice(i,1);
  }
  // enemy bullets
  for(let i=eBullets.length-1;i>=0;i--){const b=eBullets[i];b.tr.push([b.x,b.y]);if(b.tr.length>4)b.tr.shift();b.x+=b.vx*dt;b.y+=b.vy*dt;b.life-=dt;if(Math.hypot(b.x-P.x,b.y-P.y)<PRAD+4&&P.inv<=0){damageP(b.dmg||8);eBullets.splice(i,1);continue;}if(bWall(b.x,b.y)||b.life<=0){eBullets.splice(i,1);continue;}}
  // particles
  for(let i=PARTS.length-1;i>=0;i--){const p=PARTS[i];if(p.t===4){p.r=Math.min(p.mr,p.r+(p.mr-p.r)*3*dt);p.life-=dt*.022;if(p.life<=0)PARTS.splice(i,1);continue;}if(p.t===6){p.r=Math.min(p.mr,p.r+p.mr*dt*3);p.life-=dt*2.3;if(p.life<=0)PARTS.splice(i,1);continue;}const drag=p.t===2?.73:p.t===5?.57:.85;p.vx*=(1-drag*dt*3);p.vy*=(1-drag*dt*3);if(p.t===0||p.t===3)p.vy+=292*dt;p.x+=p.vx*dt;p.y+=p.vy*dt;if(p.t===3)p.ag+=p.sp*dt;const dr=p.t===1?1.1:p.t===2?3.5:p.t===5?1.62:1.5;p.life-=dt*dr;if(p.life<=0)PARTS.splice(i,1);}
  // stale remote cleanup
  const now=Date.now();Object.keys(REMOTES).forEach(k=>{if(now-REMOTES[k].lastSeen>8000)delete REMOTES[k];});
  uiHp();checkLoc();
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render(){
  drawSky();drawGround();drawTracks();
  for(const p of PARTS)if(p.t===4){const[sx,sy]=ws(p.x,p.y);X.save();X.globalAlpha=Math.min(.48,(p.r/p.mr)*(p.life/28)*1.5);X.fillStyle='#4c0000';X.beginPath();X.ellipse(sx,sy,p.r,p.r*.5,0,0,Math.PI*2);X.fill();X.restore();}
  TOWNS.forEach(t=>t.blds.forEach(drawBuilding));
  drawTrain();drawParts();
  eBullets.forEach(b=>drawBullet(b,true));bullets.forEach(b=>drawBullet(b,false));
  npcs.filter(n=>n.alive).forEach(drawNPC);police.forEach(p=>p.alive&&drawPolice(p));riders.forEach(r=>r.alive&&drawRider(r));
  drawRemotes();drawPlayer();drawMinimap();
}

// ‚îÄ‚îÄ GAME LOOP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let lastT=performance.now();
function loop(){requestAnimationFrame(loop);const now=performance.now(),dt=Math.min((now-lastT)/1000,.05);lastT=now;update(dt);render();}

// ‚îÄ‚îÄ START ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startGame(){
  document.getElementById('menu').style.display='none';document.getElementById('dead').style.display='none';
  buildCols();buildNPCs();
  P.x=0;P.y=80;P.angle=0;P.hp=100;P.maxHp=100;P.alive=true;P.money=0;P.lv=1;P.xp=0;P.medkits=0;P.mkLv=5;
  P.reloading=false;P.shootCD=0;P.dashCD=0;P.dashT=0;P.inv=0;
  ALLG.forEach(g=>{g.owned=g.id==='peacemaker';});wanted=0;wDecay=0;
  bullets.length=0;eBullets.length=0;PARTS.length=0;police.length=0;riders.length=0;respawnQ.length=0;Object.keys(REMOTES).forEach(k=>delete REMOTES[k]);
  cam.x=0;cam.y=0;TRAIN.t=0;TRAIN.cd=0;TRAIN.ntf=false;
  document.getElementById('bs').style.opacity='0';gameOn=true;
  equipGun('peacemaker');uiAmmo();uiLv();uiWanted();uiKits();document.getElementById('hmv').textContent='$0';document.getElementById('hbf').style.width='100%';
  startMPBroadcast();
}
function soloStart(){P.name=document.getElementById('mpname').value.trim().toUpperCase()||'OUTLAW';document.getElementById('mst').textContent='‚óè SOLO';startGame();}
function restartGame(){stopMP();startGame();}

loop();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MULTIPLAYER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let peer=null,conns={};
let bcastInt=null;

function mpLog(m,c){const e=document.getElementById('mpstat');e.textContent=m;e.style.color=c||'#2e3e1c';}
function mpHUD(m){document.getElementById('mst').textContent=m;}

function joinMP(){
  const name=document.getElementById('mpname').value.trim().toUpperCase()||'OUTLAW';
  const room=document.getElementById('mproom').value.trim().toUpperCase();
  if(!room){mpLog('Enter a room code','#c02014');return;}
  P.name=name;mpLog('Connecting‚Ä¶','#888418');
  if(peer){try{peer.destroy();}catch(e){}}
  peer=new Peer('dw5-'+room,{debug:0});
  peer.on('open',()=>{mpLog('Hosting: '+room,'#38a038');mpHUD('‚óè HOST: '+room+' ('+name+')');startGame();setupHost();});
  peer.on('error',err=>{
    if(err.type==='unavailable-id'){
      mpLog('Joining: '+room,'#888418');
      peer=new Peer('dw5-'+room+'-'+Math.random().toString(36).slice(2,7),{debug:0});
      peer.on('open',()=>{
        const c=peer.connect('dw5-'+room,{reliable:true,serialization:'json'});
        c.on('open',()=>{regConn(c);mpLog('In Room: '+room,'#38a038');mpHUD('‚óè IN ROOM: '+room+' ('+name+')');startGame();setupHost();});
        c.on('error',()=>mpLog('Connection failed','#c02014'));
      });
      peer.on('error',e2=>mpLog('Error: '+e2.type,'#c02014'));
    }else mpLog('Error: '+err.type,'#c02014');
  });
}

function setupHost(){
  if(!peer)return;
  peer.on('connection',c=>{
    c.on('open',()=>{
      regConn(c);
      const existing=Object.keys(conns).filter(k=>k!==c.peer);
      c.send({t:'intro',peers:existing,name:P.name});
      sysChat(c.peer.split('-').pop()+' JOINED');
    });
  });
}

function regConn(c){
  conns[c.peer]=c;
  c.on('data',d=>onData(d,c.peer));
  c.on('close',()=>{delete conns[c.peer];delete REMOTES[c.peer];sysChat(c.peer.split('-').pop()+' LEFT');});
  c.on('error',()=>{delete conns[c.peer];});
}

function bcast(msg){Object.values(conns).forEach(c=>{try{c.send(msg);}catch(e){}});}

function onData(d,from){
  if(!d?.t)return;
  switch(d.t){
    case 'state':REMOTES[from]={...d,lastSeen:Date.now()};break;
    case 'shoot':
      if(d.d){const sd=d.d;if(sd.sg){for(let i=0;i<(sd.pc||6);i++){const sp=(Math.random()-.5)*sd.spr;bullets.push({x:sd.x,y:sd.y,vx:Math.cos(sd.a+sp)*sd.spd,vy:Math.sin(sd.a+sp)*sd.spd,life:.75,tr:[],dmg:0,sg:true});}}else bullets.push({x:sd.x,y:sd.y,vx:sd.vx,vy:sd.vy,life:sd.life||1.4,tr:[],dmg:0});}break;
    case 'kill':pBlood(d.x,d.y,14);pPool(d.x,d.y);cam.shake=Math.max(cam.shake,4);break;
    case 'chat':addChat(d.name,d.msg);break;
    case 'intro':
      (d.peers||[]).forEach(pid=>{if(!conns[pid]&&pid!==peer?.id){const c=peer.connect(pid,{reliable:true,serialization:'json'});c.on('open',()=>regConn(c));}});
      break;
  }
}

function startMPBroadcast(){
  if(bcastInt)clearInterval(bcastInt);
  bcastInt=setInterval(()=>{
    if(!peer||!P.alive)return;
    bcast({t:'state',id:peer.id,name:P.name,x:~~P.x,y:~~P.y,angle:+P.angle.toFixed(2),hp:~~P.hp,alive:P.alive,lv:P.lv});
  },66);
}

function mpShoot(data){bcast({t:'shoot',d:data});}
function mpKill(x,y){bcast({t:'kill',x:~~x,y:~~y});}
function mpSendChat(msg){addChat(P.name,msg);bcast({t:'chat',name:P.name,msg});}
function stopMP(){if(bcastInt)clearInterval(bcastInt);bcastInt=null;if(peer){try{peer.destroy();}catch(e){}}peer=null;conns={};mpHUD('‚óè SOLO');}

// ‚îÄ‚îÄ CHAT UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addChat(name,msg,sys){
  const box=document.getElementById('cmsg'),el=document.createElement('div');
  el.className='cm'+(sys?' sys':'');
  el.innerHTML=sys?msg:`<span class="cn">${name}:</span>${msg}`;
  box.appendChild(el);while(box.children.length>12)box.removeChild(box.firstChild);
  setTimeout(()=>{try{box.removeChild(el);}catch(e){}},9000);
}
function sysChat(m){addChat('',m,true);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INTRO ‚Äî plays once per page load
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function(){
  const intro=document.getElementById('intro');
  function dismiss(){
    intro.style.transition='opacity 1.1s';intro.style.opacity='0';
    setTimeout(()=>{intro.style.display='none';document.getElementById('menu').style.display='flex';},1100);
  }
  setTimeout(dismiss,6000);
  intro.addEventListener('click',dismiss);
})();
</script>
</body>
</html>
